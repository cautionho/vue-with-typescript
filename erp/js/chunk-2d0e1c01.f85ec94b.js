(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e1c01"],{"7c87":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Row",{staticClass:"P-Inline-Block SendOps"},[s("Button",{attrs:{type:"primary"},on:{click:function(t){e.SendOpsMailModal=!0}}},[e._v("发送OPS站内信")]),s("Col",[s("Modal",{attrs:{title:"发送OPS系统站内信","mask-closable":!1,width:850},on:{"on-cancel":function(t){return e.EmitSendMail(!1)}},model:{value:e.SendOpsMailModal,callback:function(t){e.SendOpsMailModal=t},expression:"SendOpsMailModal"}},[s("Form",{ref:"SendPmsForm",attrs:{onsubmit:"return false",model:e.SendPmsForm,rules:e.SendPmsMsgRules,"label-width":100}},[s("Form-item",{attrs:{label:"标题：",prop:"Title"}},[s("Input",{attrs:{placeholder:"请输入标题"},model:{value:e.SendPmsForm.Title,callback:function(t){e.$set(e.SendPmsForm,"Title",t)},expression:"SendPmsForm.Title"}})],1),s("Form-item",{attrs:{label:"信息类型：",prop:"MsgType"}},[s("Select",{attrs:{placeholder:"请选择消息类型",options:e.MsgTypeList},model:{value:e.SendPmsForm.MsgType,callback:function(t){e.$set(e.SendPmsForm,"MsgType",t)},expression:"SendPmsForm.MsgType"}})],1),s("Row",[s("Col",{attrs:{span:"12"}},[s("Form-item",{staticClass:"ivu-form-item-required",attrs:{label:"全局发送："}},[s("Radio-group",{model:{value:e.SendPmsForm.IsGlobalSend,callback:function(t){e.$set(e.SendPmsForm,"IsGlobalSend",t)},expression:"SendPmsForm.IsGlobalSend"}},[s("Radio",{attrs:{label:1}},[s("span",[e._v("否")])]),s("Radio",{attrs:{label:2}},[s("span",[e._v("是")])])],1)],1)],1),s("Col",{attrs:{span:"12"}},[s("Form-item",{staticClass:"ivu-form-item-required",attrs:{label:"发送邮件："}},[s("Radio-group",{model:{value:e.SendPmsForm.IsSendEmail,callback:function(t){e.$set(e.SendPmsForm,"IsSendEmail",t)},expression:"SendPmsForm.IsSendEmail"}},[s("Radio",{attrs:{label:1}},[s("span",[e._v("否")])]),s("Radio",{attrs:{label:2}},[s("span",[e._v("是")])])],1)],1)],1)],1),1==e.SendPmsForm.IsGlobalSend?s("Form-item",{staticClass:"ivu-form-item-required",attrs:{label:"收件供应商："}},[s("Button",{attrs:{type:"primary"},on:{click:function(t){return e.AddSupplier()}}},[e._v("添加供应商")]),s("Table",{ref:"SupplierTable",staticClass:"P-MT-5",staticStyle:{"line-height":"1"},attrs:{size:"small",height:"200",columns:e.SupplierCol,data:e.SupplierData,stripe:""}})],1):e._e(),s("Form-item",{staticClass:"ivu-form-item-required",attrs:{label:"消息内容："}},[s("Editor",{ref:"Editor",attrs:{DomHeight:250}})],1)],1),s("footer",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"primary"},on:{click:e.Valid}},[e._v("发送")]),s("Button",{on:{click:function(t){return e.EmitSendMail(!1)}}},[e._v("取消")])],1)],1)],1),s("EnableSupplier",{ref:"ShowEnableModal",attrs:{AddCityList:e.CityTrees},on:{"emit-eable-supplier":e.CloseEnableSupp}})],1)},i=[],n=(s("9660"),s("76bb"),s("cee1"),s("6bf8"),s("0b78"),s("3231")),r=s("064d"),l=s("46d7"),o=s("631e"),d=s("4a81"),p=s("d11d"),u=s("c638"),m=function(e){Object(l["a"])(s,e);var t=Object(o["a"])(s);function s(){var e;return Object(n["a"])(this,s),e=t.apply(this,arguments),e.SendOpsMailModal=!1,e.SendPmsForm=new u["a"].SendOpsMails,e.MsgTypeList=e.$Utils.GetEnumArr(e.$Enums.Purchase.MsgType),e.SupplierData=[],e.IsLoadingEnableTab=!0,e.SendPmsMsgRules={Title:[{required:!0,message:"请输入标题"}],MsgType:[{required:!0,message:"请选择信息类型",trigger:"change",type:"number"}]},e.SupplierCol=[{title:"供应商名称",key:"SupplyName"},{title:"操作",width:100,render:function(t,s){return t("Button",{props:{size:"small",type:"error"},on:{click:function(){e.DelSupplier(s.index)}}},"删除")}}],e}return Object(r["a"])(s,[{key:"EmitSendMail",value:function(e){this.SendOpsMailModal=!1,this.$refs["SendPmsForm"].resetFields(),this.$set(this,"SendPmsForm",new u["a"].SendOpsMails),this.$refs["Editor"].SetContent(""),this.SupplierData=[]}},{key:"ChangeGlobal",value:function(){this.SupplierData=[]}},{key:"AddSupplier",value:function(){this.$refs["ShowEnableModal"].TriggerModal(!0,this.IsLoadingEnableTab,!0)}},{key:"Valid",value:function(){var e=this;this.$refs["SendPmsForm"].validate((function(t){if(t){if(1==e.SendPmsForm.IsGlobalSend&&e.SupplierData.length<1)return void e.$UI.Tips.Floating("warning","请选择供应商");if(void 0==e.$refs["Editor"].GetContent()||""==e.$refs["Editor"].GetContent()||"<p><br></p>"==e.$refs["Editor"].GetContent())return void e.$UI.Tips.Floating("warning","请输入消息内容");e.PostSend()}}))}},{key:"PostSend",value:function(){var e=this,t=JSON.parse(JSON.stringify(this.SendPmsForm));t.IsGlobalSend=1!==t.IsGlobalSend,t.IsSendEmail=1!==t.IsSendEmail,t.Content=this.$refs["Editor"].GetContent(),t.SupplyIds=this.SupplierData.map((function(e){return e.Id})),t.OperateName=JSON.parse(this.$Cookie.Get("frler_user")).UserName,t.OperateId=JSON.parse(this.$Cookie.Get("frler_user")).UserId,this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:this.$Api.SupplySendPMSMessage,Login:!0},Data:t,Callback:function(t){t.IsSuccess?(e.$UI.Tips.Floating("success","发送OPS系统站内信成功"),e.EmitSendMail(!0)):(e.$Request.Error(t),e.$UI.Loading.Hide())}})}},{key:"CloseEnableSupp",value:function(e,t,s){var a=this;this.IsLoadingEnableTab=t,s&&s.forEach((function(e){var t=!1;a.SupplierData.forEach((function(s){s.Id===e.Id&&(t=!0)})),t||a.SupplierData.push(e)}))}},{key:"DelSupplier",value:function(e){this.SupplierData.splice(e,1)}},{key:"CityTrees",get:function(){return this.CityList}}]),s}(p["d"]);d["a"]([Object(p["c"])()],m.prototype,"CityList",void 0),d["a"]([Object(p["b"])()],m.prototype,"EmitSendMail",null),d["a"]([Object(p["e"])("SendPmsForm.IsGlobalSend")],m.prototype,"ChangeGlobal",null),m=d["a"]([Object(p["a"])({name:"SendOpsMail",components:{Editor:function(){return s.e("chunk-0804eda8").then(s.bind(null,"bf42"))},EnableSupplier:function(){return s.e("chunk-2d224590").then(s.bind(null,"e06e"))}}})],m);var c=m,S=c,b=s("4023"),f=Object(b["a"])(S,a,i,!1,null,null,null);t["default"]=f.exports}}]);