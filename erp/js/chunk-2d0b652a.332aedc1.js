(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b652a"],{"1d56":function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Row",{staticClass:"P-Inline-Block"},[s("Col",[e.Power?s("Button",{staticClass:"P-MR-10",attrs:{type:"primary"},on:{click:e.TriggerModal}},[e._v("添加客户")]):e._e(),s("Modal",{staticClass:"Container-Tabs",attrs:{title:(0!==e.CustomerMsg.Customer.Id?"修改":"添加")+"用户","mask-closable":!1,width:860},on:{"on-cancel":function(t){return e.HandleRes(!1)}},model:{value:e.IsShowModal,callback:function(t){e.IsShowModal=t},expression:"IsShowModal"}},[s("Tabs",{attrs:{type:"card",name:"ModifyCustomer",value:e.CurrentPane,id:"crmTabs"},on:{"on-click":e.ChangePane}},[s("TabPane",{attrs:{label:"基本信息",name:"Pane-1",tab:"ModifyCustomer"}},[s("Form",{ref:"CustomerMsg",attrs:{onsubmit:"return false",model:e.CustomerMsg,rules:e.customerRules,"label-width":85,inline:"",name:"crmForm"}},[s("Form-item",{staticClass:"P-W-400",attrs:{label:"公司：",prop:"Customer.Company"}},[s("Input",{attrs:{placeholder:"请输入公司名称",name:"crmInput"},model:{value:e.CustomerMsg.Customer.Company,callback:function(t){e.$set(e.CustomerMsg.Customer,"Company",t)},expression:"CustomerMsg.Customer.Company"}})],1),s("Form-item",{staticClass:"P-W-400",attrs:{label:"联系人：",prop:"Customer.Contact"}},[s("Input",{attrs:{placeholder:"请输入联系人"},model:{value:e.CustomerMsg.Customer.Contact,callback:function(t){e.$set(e.CustomerMsg.Customer,"Contact",t)},expression:"CustomerMsg.Customer.Contact"}})],1),s("Form-item",{staticClass:"P-W-400",attrs:{label:"电话：",prop:"Customer.Phone"}},[s("Input",{attrs:{placeholder:"请输入电话"},model:{value:e.CustomerMsg.Customer.Phone,callback:function(t){e.$set(e.CustomerMsg.Customer,"Phone",t)},expression:"CustomerMsg.Customer.Phone"}})],1),s("Form-item",{staticClass:"P-W-400",attrs:{label:"邮箱：",prop:"Customer.Email"}},[s("Input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.CustomerMsg.Customer.Email,callback:function(t){e.$set(e.CustomerMsg.Customer,"Email",t)},expression:"CustomerMsg.Customer.Email"}})],1),s("Form-item",{staticClass:"P-W-400",attrs:{label:"邮编：",prop:"Customer.ZipCode"}},[s("Input",{attrs:{placeholder:"请输入邮编"},model:{value:e.CustomerMsg.Customer.ZipCode,callback:function(t){e.$set(e.CustomerMsg.Customer,"ZipCode",t)},expression:"CustomerMsg.Customer.ZipCode"}})],1),s("br"),s("Form-item",{staticClass:"P-W-98-Percent P-MB-5 ivu-form-item-required",attrs:{label:"地址："}},[s("Form-item",{staticClass:"P-W-200",attrs:{prop:"Customer.Province"}},[s("Select",{attrs:{placeholder:"请选择省份",options:e.CountryList,optionValKey:"value",optionKey:"label",onChange:e.OnClearSelect.bind(this,"Province"),transfer:""},model:{value:e.CustomerMsg.Customer.Province,callback:function(t){e.$set(e.CustomerMsg.Customer,"Province",t)},expression:"CustomerMsg.Customer.Province"}})],1),s("Form-item",{staticClass:"P-W-200",attrs:{prop:"Customer.City"}},[s("Select",{ref:"city",attrs:{placeholder:"请选择城市",options:e.CityList,optionValKey:"value",optionKey:"label",onChange:e.OnClearSelect.bind(this,"City"),transfer:""},model:{value:e.CustomerMsg.Customer.City,callback:function(t){e.$set(e.CustomerMsg.Customer,"City",t)},expression:"CustomerMsg.Customer.City"}})],1),s("Form-item",{staticClass:"P-W-200",attrs:{prop:"Customer.Area"}},[s("Select",{ref:"area",attrs:{placeholder:"请选择区县",options:e.AreaList,optionValKey:"value",optionKey:"label",onChange:e.OnClearSelect.bind(this,"Area"),transfer:""},model:{value:e.CustomerMsg.Customer.Area,callback:function(t){e.$set(e.CustomerMsg.Customer,"Area",t)},expression:"CustomerMsg.Customer.Area"}})],1)],1),s("Form-item",{staticClass:"P-W-100-Percent",attrs:{prop:"Customer.Street"}},[s("Input",{staticClass:"mt20",attrs:{placeholder:"请输入详细街道"},model:{value:e.CustomerMsg.Customer.Street,callback:function(t){e.$set(e.CustomerMsg.Customer,"Street",t)},expression:"CustomerMsg.Customer.Street"}})],1),s("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"备注：",prop:"Customer.Remark"}},[s("Input",{attrs:{placeholder:"请输入备注",type:"textarea",autosize:{minRows:4,maxRows:4}},model:{value:e.CustomerMsg.Customer.Remark,callback:function(t){e.$set(e.CustomerMsg.Customer,"Remark",t)},expression:"CustomerMsg.Customer.Remark"}})],1)],1)],1),s("TabPane",{attrs:{label:"渠道折扣",name:"Pane-2",tab:"ModifyCustomer"}},[s("p",[e._v("渠道各类费用折扣默认为1，例如8折请输入0.8")]),s("Form",{attrs:{onsubmit:"return false",inline:"","label-width":80}},[s("Form-item",{attrs:{label:"添加渠道："}},[s("Select",{ref:"shippingMethods",attrs:{placeholder:"请选择渠道",options:e.MethodList,optionValKey:"Id",optionKey:"Name",onChange:e.GetShippingMethods,transfer:""},model:{value:e.ShippingMethodId,callback:function(t){e.ShippingMethodId=t},expression:"ShippingMethodId"}})],1),s("Table",{ref:"Discount",attrs:{columns:e.Cols,data:e.CustomerMsg.Discount,size:"small",stripe:"",height:"400"}})],1)],1)],1),s("footer",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"primary"},on:{click:function(t){return e.PostCustomerMsg()}}},[e._v("提交")]),s("Button",{on:{click:function(t){return e.HandleRes(!1)}}},[e._v("取消")])],1)],1)],1)],1)},r=[],i=(s("cee1"),s("3231")),n=s("064d"),a=s("46d7"),u=s("631e"),l=s("4a81"),m=s("d11d"),C=s("eb54"),c=function(e){Object(a["a"])(s,e);var t=Object(u["a"])(s);function s(){var e;return Object(i["a"])(this,s),e=t.apply(this,arguments),e.IsShowModal=!1,e.CurrentPane="Pane-1",e.MethodList=[],e.CustomerMsg=new C["a"].ModifyCustomer,e.ShippingMethodId="",e.CityList=[],e.AreaList=[],e.customerRules={"Customer.Company":[{required:!0,message:"请输入公司名称"}],"Customer.Contact":[{required:!0,message:"请输入联系人"}],"Customer.Phone":[{required:!0,message:"请输入电话",trigger:"blur"},{pattern:/^(([1]\d{10})$|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/,message:"请输入正确的电话"}],"Customer.Email":[{required:!0,message:"请输入邮箱"},{pattern:/^[0-9A-Za-z][\.0-9A-Za-z_-]+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/,message:"请输入正确的邮箱"}],"Customer.ZipCode":[{required:!0,message:"请输入邮编"}],"Customer.Province":[{required:!0,message:"请选择省份",trigger:"change",type:"number"}],"Customer.City":[{required:!0,message:"请选择市",trigger:"change",type:"number"}]},e.Cols=[{title:"渠道",key:"MethodName"},{title:"运费",render:function(t,s){return t("InputNumber",{props:{min:0,max:1,step:.1,value:s.row.FeeDiscount},on:{input:function(t){e.ChangeInput(s.row._index,"FeeDiscount",t)}}})}},{title:"附加费",render:function(t,s){return t("InputNumber",{props:{min:0,max:1,step:.1,value:s.row.AdditionalFeeDiscount},on:{input:function(t){e.ChangeInput(s.row._index,"AdditionalFeeDiscount",t)}}})}},{title:"处理费",render:function(t,s){return t("InputNumber",{props:{min:0,max:1,step:.1,value:s.row.ProcessingDiscount},on:{input:function(t){e.ChangeInput(s.row._index,"ProcessingDiscount",t)}}})}},{title:"挂号费",render:function(t,s){return t("InputNumber",{props:{min:0,max:1,step:.1,value:s.row.RegistryDiscount},on:{input:function(t){e.ChangeInput(s.row._index,"RegistryDiscount",t)}}})}},{title:"操作",width:80,render:function(t,s){return t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.DeleteCol(s.row._index)}}},"删除")}}],e}return Object(n["a"])(s,[{key:"HandleRes",value:function(e){var t=this;this.IsShowModal=!1,this.$nextTick((function(){t.$refs["CustomerMsg"].resetFields()})),this.CustomerMsg=new C["a"].ModifyCustomer,this.CurrentPane="Pane-1"}},{key:"OnClearSelect",value:function(e){void 0==this.CustomerMsg.Customer[e]&&this.$set(this.CustomerMsg.Customer,e,"")}},{key:"ChangeProvince",value:function(e){if(""!=e)for(var t in this.CountryList)this.CountryList[t].value==e&&(this.CityList=this.CountryList[t].children);else this.CustomerMsg.Customer.City="",this.CustomerMsg.Customer.Area="",this.$refs.city.clearSingleSelect(),this.$refs.area.clearSingleSelect(),this.CityList=[],this.AreaList=[]}},{key:"ChangeCity",value:function(e){if(""!=e)for(var t in this.CityList)this.CityList[t].value==e&&(this.AreaList=this.CityList[t].children);else this.CustomerMsg.Customer.Area="",this.$refs.area.clearSingleSelect(),this.AreaList=[]}},{key:"TriggerModal",value:function(e){var t=document.getElementById("crmTabs").getElementsByClassName("ivu-tabs-tab")[1];this.IsShowDiscount?t.style.display="inline-block":t.style.display="none",e.length&&(this.CustomerMsg.Customer=JSON.parse(JSON.stringify(e[0])),this.IsShowDiscount&&this.GetCustomerDiscount(this.CustomerMsg.Customer.Id)),this.MethodList.length<1&&this.GetMethodsList(),this.$set(this,"IsShowModal",!0)}},{key:"GetMethodsList",value:function(){var e=this;this.$Request.Post({Server:this.$Server.Logistics,Api:{Address:this.$Api.ChannelDropList,Login:!1},Data:0,Callback:function(t){t.IsSuccess?e.MethodList=t.Data.DropList:e.$Request.Error(t)}})}},{key:"GetCustomerDiscount",value:function(e){var t=this;this.$UI.Loading.Show();var s={CustomerId:e,CustomerCode:""};this.$Request.Post({Server:this.$Server.Logistics,Api:{Address:this.$Api.GetCustomerDiscount,Login:!1},Data:s,Callback:function(e){t.$UI.Loading.Hide(),e.IsSuccess?t.CustomerMsg.Discount=e.Data.Data:t.$Request.Error(e)}})}},{key:"GetShippingMethods",value:function(e){if(void 0!=e){for(var t in this.CustomerMsg.Discount)if(this.CustomerMsg.Discount[t].ShippingMethodId==e.value)return this.$UI.Tips.Floating("warning","该渠道在列表中已存在"),this.ShippingMethodId="",void this.$refs.shippingMethods.clearSingleSelect();var s=new C["a"].DiscountInfo;s.CustomerId=this.CustomerMsg.Customer.Id,s.CustomerCode=this.CustomerMsg.Customer.CustomerCode,s.ShippingMethodId=e.value,s.MethodName=e.label,this.CustomerMsg.Discount.push(s),this.ShippingMethodId="",this.$refs.shippingMethods.clearSingleSelect()}}},{key:"ChangePane",value:function(e){this.CurrentPane=e}},{key:"PostCustomerMsg",value:function(){var e=this;this.$refs["CustomerMsg"].validate((function(t){t&&(e.$UI.Loading.Show(),e.$Request.Post({Server:e.$Server.Logistics,Api:{Address:0!==e.CustomerMsg.Customer.Id?e.$Api.CustomerModify:e.$Api.CustomerCreate,Login:!1},Data:e.CustomerMsg,Callback:function(t){t.IsSuccess?(e.$UI.Tips.Floating("success",(0!==e.CustomerMsg.Customer.Id?"修改":"添加")+"客户成功"),e.HandleRes(!1)):(e.$UI.Loading.Hide(),e.$Request.Error(t))}}))}))}},{key:"ChangeInput",value:function(e,t,s){this.CustomerMsg.Discount[e][t]=s}},{key:"DeleteCol",value:function(e){this.CustomerMsg.Discount.splice(e,1)}},{key:"CountryList",get:function(){return this.CityDropList}}]),s}(m["d"]);l["a"]([Object(m["c"])()],c.prototype,"Power",void 0),l["a"]([Object(m["c"])()],c.prototype,"IsShowDiscount",void 0),l["a"]([Object(m["c"])()],c.prototype,"CityDropList",void 0),l["a"]([Object(m["b"])()],c.prototype,"HandleRes",null),l["a"]([Object(m["e"])("CustomerMsg.Customer.Province")],c.prototype,"ChangeProvince",null),l["a"]([Object(m["e"])("CustomerMsg.Customer.City")],c.prototype,"ChangeCity",null),c=l["a"]([Object(m["a"])({name:"ModifyCustomer"})],c);var p=c,d=p,h=s("4023"),g=Object(h["a"])(d,o,r,!1,null,null,null);t["default"]=g.exports}}]);