(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32c35136"],{"2f5a":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Row",{staticClass:"P-Inline-Block",staticStyle:{"vertical-align":"middle"}},[a("Button",{staticClass:"P-Inline-Block",attrs:{type:"primary"},on:{click:e.OpenModal}},[e._v("创建退件工单")]),a("Modal",{attrs:{"mask-closable":!1,closable:!1,width:1300},model:{value:e.IsShowModal,callback:function(t){e.IsShowModal=t},expression:"IsShowModal"}},[a("div",{staticClass:"ivu-modal-header-inner",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s(["创建退件工单","扫描签收"][e.ModalType]))]),a("span",{staticStyle:{float:"right",cursor:"pointer"},on:{click:function(t){return e.CancelModal(!1)}}},[a("Icon",{attrs:{type:"md-close"}})],1)]),a("Row",[a("Col",{attrs:{span:24}},[a("Form",{attrs:{inline:"","label-width":100,onsubmit:"return false"}},[a("Form-item",{attrs:{label:"跟踪号："}},[a("Input",{ref:"TrackingCode_Ipt",attrs:{placeholder:"请输入/扫描跟踪号"},on:{"on-enter":e.GetShipOrderDetails},model:{value:e.TrackingCode,callback:function(t){e.TrackingCode="string"===typeof t?t.trim():t},expression:"TrackingCode"}},[a("Button",{attrs:{slot:"append"},on:{click:function(t){return e.FocusTrackIpt(!0)}},slot:"append"},[e._v("清除跟踪号")])],1)],1),a("Form-item",{attrs:{label:"物流渠道："}},[a("Select",{attrs:{placeholder:"请选择物流渠道",options:e.PropShippingMethodDrop,optionValKey:"Id",optionKey:"Name"},model:{value:e.ShippingMethodId,callback:function(t){e.ShippingMethodId=t},expression:"ShippingMethodId"}})],1),a("Button",{staticClass:"P-MR-10",attrs:{type:"primary"},on:{click:function(t){return e.SubModal(0)}}},[e._v("提交")]),a("Button",{staticClass:"P-MR-10",attrs:{type:"primary"},on:{click:function(t){return e.SubModal(1)}}},[e._v("完成工单")]),a("Button",{attrs:{type:"primary"},on:{click:e.BatchEditReturnReason}},[e._v("批量添加退件原因")])],1)],1),a("Col",{attrs:{span:24}},[a("Table",{ref:"TableList",attrs:{height:530,columns:e.TableRowHead,data:e.TableList,size:"small",stripe:"",border:""},on:{"on-selection-change":e.TableGetSelected}})],1)],1),a("footer",{attrs:{slot:"footer"},slot:"footer"})],1),a("Modal",{attrs:{"mask-closable":!1,width:600,title:"批量添加退件原因"},on:{"on-cancel":e.ClearReasonModal},model:{value:e.ShowBatchEditReasonModal,callback:function(t){e.ShowBatchEditReasonModal=t},expression:"ShowBatchEditReasonModal"}},[a("Form",{attrs:{onsubmit:"return false","label-width":100}},[a("FormItem",{attrs:{label:"退件原因：",required:""}},[a("Input",{ref:"BatchReturnReason_Ipt",attrs:{maxlength:"200","show-word-limit":"",type:"textarea",autosize:{minRows:4,maxRows:5},placeholder:"请输入退件原因"},model:{value:e.BatchReturnReason,callback:function(t){e.BatchReturnReason=t},expression:"BatchReturnReason"}})],1)],1),a("footer",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:e.SubBatchEditReason}},[e._v("确定")]),a("Button",{attrs:{type:"default"},on:{click:e.ClearReasonModal}},[e._v("取消")])],1)],1),a("ShipOrderDetails",{ref:"ShipOrderDetails"})],1)},n=[],o=(a("d9b9"),a("5e8c"),a("76bb"),a("6ed5"),a("cee1"),a("e8f2"),a("6bf8"),a("b74e"),a("e24e")),s=a("5c62"),r=a("3231"),l=a("064d"),c=a("46d7"),d=a("631e"),h=a("4a81"),u=a("d11d"),p=a("1f41"),T=function(e){Object(c["a"])(a,e);var t=Object(d["a"])(a);function a(){var e;return Object(r["a"])(this,a),e=t.apply(this,arguments),e.ShowBatchEditReasonModal=!1,e.IsShowModal=!1,e.ModalType=0,e.ModifyDetails=new p["a"].LogisticsReturnOrderTable,e.TableListBefore=[],e.TableList=[],e.TableSelected=[],e.TableRowHead=[{title:"",renderHeader:function(t,a){return t("span",{style:{fontSize:"14px"}},"已扫描 ".concat(e.TableList.length," 个退件订单"))},children:[{type:"selection",width:60,align:"center"},{title:"序号",type:"index",width:70},{title:"物流渠道",key:"ShippingMethodName"},{title:"跟踪号",key:"TrackingNumber"},{title:"发货订单",key:"ShipOrderCode",render:function(t,a){return t("a",{style:{cursor:"pointer"},on:{click:function(){e.TriggerShipOrderDetails(a.row.ShipOrderCode)}}},a.row.ShipOrderCode)}},{title:"下单时间",key:"PlatOrderTime",width:160,render:function(t,a){return t("span",e.$UI.Render.Date(a.row.PlatOrderTime,!0))}},{title:"签收时间",key:"ScannedReceiptTime",width:160,render:function(t,a){return t("span",e.$UI.Render.Date(a.row.ScannedReceiptTime,!0))}},{title:"退件原因",key:"ReturnReason",render:function(t,a){return t("Input",{props:{value:a.row.ReturnReason},attrs:{placeholder:"请输入退件原因"},on:{"on-change":function(t){e.SetLocationCode(t.target.value,a.index)}}})}},{title:"操作",width:80,render:function(t,a){return t("div",[t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.TableList.splice(a.row._index,1)}}},"删除")])}}]}],e.TrackingCode="",e.ShippingMethodId="",e.DropShippingMethod=[],e.BatchReturnReason="",e}return Object(l["a"])(a,[{key:"EmitChange",value:function(e){}},{key:"$Trigger",value:function(e){e.IsShowModal;var t=e.SelectedDetail,a=e.ModalType;this.$set(this,"ModalType",a),0===this.ModalType?(this.$set(this,"IsShowModal",!0),this.IsShowModal=!0,this.FocusTrackIpt(!0)):(this.$set(this,"ModifyDetails",t),this.GetReturnLogisticsDetail())}},{key:"OpenModal",value:function(){this.$set(this,"ModalType",0),this.$set(this,"IsShowModal",!0),this.FocusTrackIpt(!0)}},{key:"GetReturnLogisticsDetail",value:function(){var e=this,t={Id:this.ModifyDetails.Id,Code:this.ModifyDetails.ReturnLogisticsCode};this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Warehouse,Api:{Address:this.$Api.ReturnLogisticsGeDetail,Login:!0},Data:t,Callback:function(t){var a,i;(e.$UI.Loading.Hide(),t.IsSuccess)?((a=e.TableListBefore).push.apply(a,Object(s["a"])(JSON.parse(JSON.stringify(t.Data.Data.ReturnLogisticsItemResultModel)))),(i=e.TableList).push.apply(i,Object(s["a"])(JSON.parse(JSON.stringify(t.Data.Data.ReturnLogisticsItemResultModel)))),e.IsShowModal=!0,e.FocusTrackIpt(!0)):e.$Request.Error(t)}})}},{key:"FocusTrackIpt",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$nextTick((function(){e.$refs["TrackingCode_Ipt"].focus(),t&&e.$set(e,"TrackingCode","")}))}},{key:"GetShipOrderDetails",value:function(){var e=this;if(""===this.TrackingCode)return this.$UI.Tips.Floating("warning","请输入/扫描跟踪号"),void this.FocusTrackIpt();var t=this.TrackingCode.length;[161,162,173,174,157,158].includes(this.ShippingMethodId)&&this.TrackingCode.startsWith("420")&&(30===t||34===t)&&(this.TrackingCode=this.TrackingCode.substr(-22)),[189,191,190,192].includes(this.ShippingMethodId)&&this.TrackingCode.startsWith("420")&&30===t&&(this.TrackingCode=this.TrackingCode.substr(-22)),154===this.ShippingMethodId&&this.TrackingCode.startsWith("JJD")&&19===t&&(this.TrackingCode=this.TrackingCode.substr(-18)),176===this.ShippingMethodId&&20===t&&(this.TrackingCode=this.TrackingCode.substr(-18)),this.TableList.some((function(t){return t.TrackingNumber===e.TrackingCode}))?this.$UI.Tips.CustomModal({Type:"warning",Content:"".concat(this.TrackingCode,"已存在列表"),Callback:function(t){e.FocusTrackIpt()}}):(this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Warehouse,Api:{Address:this.$Api.GetShipOrderByTrackCode,Login:!0},Data:this.TrackingCode,Callback:function(t){if(e.$UI.Loading.Hide(),t.IsSuccess){if(null==t.Data.Data)return void e.$UI.Tips.CustomModal({Type:"warning",Content:"".concat(e.TrackingCode,"无法匹配发货单，请重新扫描"),Callback:function(t){e.FocusTrackIpt()}});if(6!=t.Data.Data.Status){var a=["","待检查","已确认","待拣货","已拣货","已打包","","缺货","已拦截","联系客户"];return a[99]="已拦截",void e.$UI.Tips.CustomModal({Type:"warning",Content:"只有已发货状态的才可以扫描签收，".concat(e.TrackingCode,"状态为").concat(a[t.Data.Data.Status]),Callback:function(t){e.FocusTrackIpt(!0)}})}if(""!=e.ShippingMethodId&&e.ShippingMethodId!=t.Data.Data.ShippingMethodId)return void e.$UI.Tips.CustomModal({Type:"warning",Content:"请扫描/输入相同物流渠道的跟踪号",Callback:function(t){e.FocusTrackIpt(!0)}});if(0!=e.TableList.length&&t.Data.Data.ShippingMethodId!=e.TableList[0].ShippingMethodId)return void e.$UI.Tips.CustomModal({Type:"warning",Content:"请扫描/输入相同物流渠道的跟踪号",Callback:function(t){e.FocusTrackIpt(!0)}});var i={Id:t.Data.Data.Id,ReturnLogisticsCode:"",ShippingMethodId:t.Data.Data.ShippingMethodId,ShippingMethodName:t.Data.Data.MethodName,ShipOrderCode:t.Data.Data.OrderCode,TrackingNumber:t.Data.Data.TrackingNumber,PlatOrderTime:t.Data.Data.PlatOrderTime,ScannedReceiptTime:e.$UI["Render"].NewDate(new Date,!0),ReturnReason:"",IsNewly:!0};e.TableList.push(i),e.$set(e,"ShippingMethodId",t.Data.Data.ShippingMethodId),e.FocusTrackIpt(!0)}else e.$Request.Error(t,(function(){return e.FocusTrackIpt(!0)}))}}))}},{key:"SubModal",value:function(e){var t=this;0!==this.TableList.length?(this.$refs["TableList"].selectAll(!0),this.$UI.Tips.Modal({Type:"confirm",Content:["本次扫描签收".concat(this.TableList.length,"个退件订单, 是否要全部提交？"),"是否要完成工单，完成后将不能继续扫描签收退件订单？"][e],Callback:function(a){if(a){var i=new p["a"].LogisticsReturnOrderModifySubInfo([0,t.ModifyDetails.Id][t.ModalType],["",t.ModifyDetails.ReturnLogisticsCode][t.ModalType],t.TableList[0].ShippingMethodId,[1,2][e],t.TableList.length,[t.$UI["Render"].NewDate(new Date,!0),t.ModifyDetails.CreateTime][t.ModalType],["",t.$UI["Render"].NewDate(new Date,!0)][t.ModalType]),n=t.TableList.map((function(e,a){return new p["a"].LogisticsReturnOrderModifySubItem([e.Id,0][Number(e.IsNewly)],["",e.ReturnLogisticsCode][t.ModalType],a,e.ShippingMethodId,e.ShippingMethodName,e.ShipOrderCode,e.TrackingNumber,e.PlatOrderTime,e.ReturnReason,t.$UI["Render"].NewDate(new Date,!0))}));t.$UI.Loading.Show(),t.$Request.Post({Server:t.$Server.Warehouse,Api:{Address:t.$Api.ReturnLogisticsSave,Login:!0},Data:{ReturnLogisticsInfo:i,ReturnLogisticsItems:n,IsComplete:Boolean(e)},Callback:function(a){t.$UI.Loading.Hide(),a.IsSuccess?(0===e?t.$UI.Tips.Floating("success",["退件订单签收成功，创建工单".concat(a.Data.ReturnLogisticsCode),"退件订单签收成功"][t.ModalType]):t.$UI.Tips.Floating("success","工单已签收完成"),t.CancelModal(!0)):t.$Request.Error(a)}})}else t.TableCancelSelected()}})):this.$UI.Tips.Floating("warning","请先扫描签收退件订单再进行操作")}},{key:"BatchEditReturnReason",value:function(){var e=this;0!==this.TableSelected.length?(this.$set(this,"ShowBatchEditReasonModal",!0),this.$nextTick((function(){e.$refs["BatchReturnReason_Ipt"].focus()}))):this.$UI.Tips.Floating("warning","请先选择退件订单再进行操作")}},{key:"SubBatchEditReason",value:function(){var e=this;if(""==this.BatchReturnReason)return this.$UI.Tips.Floating("warning","请输入退件原因"),void this.$nextTick((function(){e.$refs["BatchReturnReason_Ipt"].focus()}));var t,a=Object(o["a"])(this.TableSelected);try{for(a.s();!(t=a.n()).done;){var i,n=t.value,s=Object(o["a"])(this.TableList);try{for(s.s();!(i=s.n()).done;){var r=i.value;if(n.Id===r.Id){this.$set(r,"ReturnReason",this.BatchReturnReason);break}}}catch(l){s.e(l)}finally{s.f()}}}catch(l){a.e(l)}finally{a.f()}this.$UI.Tips.Floating("success","批量添加退件原因成功"),this.ClearReasonModal()}},{key:"ClearReasonModal",value:function(){this.$set(this,"BatchReturnReason",""),this.$set(this,"ShowBatchEditReasonModal",!1)}},{key:"TableCancelSelected",value:function(){this.$refs["TableList"].selectAll(!1),this.$set(this,"TableSelected",[])}},{key:"TableGetSelected",value:function(e){this.$set(this,"TableSelected",e)}},{key:"CancelModal",value:function(e){var t=this;e||!(0===this.ModalType&&0!==this.TableList.length||this.TableListBefore.length!==this.TableList.length||0!==this.TableListBefore.length&&0!==this.TableList.length&&this.TableListBefore[0].ShippingMethodId!==this.TableList[0].ShippingMethodId||this.TableList.some((function(e,a){return e.Id!==t.TableListBefore[a].Id||e.ReturnReason!==t.TableListBefore[a].ReturnReason})))?(this.$set(this,"IsShowModal",!1),this.$set(this,"ModalType",0),this.$set(this,"ModifyDetails",new p["a"].LogisticsReturnOrderTable),this.TableList.splice(0),this.TableListBefore.splice(0),this.EmitChange(!0)):this.$UI.Tips.CustomModal({Type:"warning",Content:"列表有退件订单未提交,是否要关闭窗口？",Callback:function(e){e&&t.CancelModal(!0)}})}},{key:"TriggerShipOrderDetails",value:function(e){this.$refs.ShipOrderDetails.Validate({OrderId:0,OrderCode:e})}},{key:"SetLocationCode",value:function(e,t){this.TableList[t].ReturnReason=e}}]),a}(u["d"]);h["a"]([Object(u["c"])()],T.prototype,"PropShippingMethodDrop",void 0),h["a"]([Object(u["b"])()],T.prototype,"EmitChange",null),T=h["a"]([Object(u["a"])({name:"LogisticsReturnOrderModify",components:{ShipOrderDetails:function(){return a.e("chunk-1c5a19f1").then(a.bind(null,"6652"))}}})],T);var g=T,f=g,b=(a("4efe"),a("4023")),I=Object(b["a"])(f,i,n,!1,null,"71843f3b",null);t["default"]=I.exports},"4efe":function(e,t,a){"use strict";var i=a("51a1"),n=a.n(i);n.a},"51a1":function(e,t,a){}}]);