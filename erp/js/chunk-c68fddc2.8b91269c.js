(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c68fddc2"],{1088:function(e,t,a){"use strict";var n=a("88ce"),r=a.n(n);r.a},"54f4":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Row",[a("Form",{ref:"HandleForm",attrs:{model:e.HandleForm,onsubmit:"return false","label-width":100}},[a("Checkbox",{on:{"on-change":e.PostSelectNotRefund},model:{value:e.REFUND_INFO.IsSelectNoRefund,callback:function(t){e.$set(e.REFUND_INFO,"IsSelectNoRefund",t)},expression:"REFUND_INFO.IsSelectNoRefund"}},[e._v(" 买家升级后，系统不自动退款")]),a("FormItem",{staticClass:"P-MB-10",attrs:{label:"操作："}},[a("RadioGroup",{model:{value:e.HandleType,callback:function(t){e.HandleType=t},expression:"HandleType"}},[e._l(e.REFUND_INFO.AvailableOptionsList,(function(t,n){return a("Radio",{directives:[{name:"show",rawName:"v-show",value:e.$Enums.CustomerService.HandleRefundType[t],expression:"$Enums.CustomerService.HandleRefundType[Item]"}],key:n,attrs:{label:t}},[a("span",[e._v(e._s(e.$Enums.CustomerService.HandleRefundType[t])+" ")])])})),a("Radio",{attrs:{label:"RESEND"}},[a("span",[e._v("重发")])])],2)],1),e.HandleType.includes("REFUND")?a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:e.SHIP_ORDER_INFO.Id?"金额：":"",rules:{required:"SELLER_OFFER_PARTIAL_REFUND"===e.HandleType,message:"请输入金额",type:"number",pattern:e.$Pattern.PositiveNotZero,trigger:"change"},prop:"Amount"}},[e.SHIP_ORDER_INFO.Id?"SELLER_OFFER_PARTIAL_REFUND"===e.HandleType?a("Col",[a("InputNumber",{staticClass:"P-W-400",attrs:{min:0,max:e.SHIP_ORDER_INFO.PayPrice},model:{value:e.HandleForm.Amount,callback:function(t){e.$set(e.HandleForm,"Amount",t)},expression:"HandleForm.Amount"}}),e._v(" "+e._s(e.SHIP_ORDER_INFO.PayCurrency)+" ")],1):a("span",[e._v(e._s(e.SHIP_ORDER_INFO.PayPrice)+" "+e._s(e.SHIP_ORDER_INFO.PayCurrency))]):a("h3",{staticClass:"P-Text-Error"},[e._v(" 无订单数据，无法操作此项！ ")])],1)],1):e._e(),"SELLER_ESCALATE"===e.HandleType?a("Col",[a("FormItem",{attrs:{label:"原因：",rules:{required:"SELLER_ESCALATE"===e.HandleType,message:"请选择原因",trigger:"change",type:"number"},prop:"TypeReason"}},[a("Select",{attrs:{placeholder:"原因",options:e.InquiryReasonList},model:{value:e.HandleForm.TypeReason,callback:function(t){e.$set(e.HandleForm,"TypeReason",t)},expression:"HandleForm.TypeReason"}})],1)],1):e._e(),"RESEND"!==e.HandleType?a("Col",{attrs:{span:"24"}},[a("FormItem",{staticClass:"P-MB-10",attrs:{label:"模板类型："}},[a("Select",{attrs:{placeholder:"模板类型",onChange:e.GetTemplateListLoading,options:e.TemplateTypeDrop},model:{value:e.TplType,callback:function(t){e.TplType=t},expression:"TplType"}})],1),a("FormItem",{staticClass:"P-MB-10",attrs:{label:"模板："}},[a("div",{staticClass:"Tpl-Container"},e._l(e.TemplateList,(function(t,n){return a("a",{key:n,staticClass:"P-MR-5",on:{click:function(a){return e.RenderContent(t)}}},[e._v(e._s("("+(n+1)+") "+t.TemplateTitle))])})),0)]),a("FormItem",{attrs:{label:"消息：",rules:{required:"SELLER_SEND_MESSAGE"===e.HandleType,message:"请输入消息"},prop:"Content"}},[a("Input",{attrs:{placeholder:"消息",type:"textarea",autosize:{minRows:6,maxRows:6}},model:{value:e.HandleForm.Content,callback:function(t){e.$set(e.HandleForm,"Content",t)},expression:"HandleForm.Content"}})],1)],1):a("Col",{attrs:{span:"24"}},[a("FormItem",{staticClass:"P-MB-0"},[a("Button",{attrs:{type:"primary"},on:{click:e.TriggerAfterSalesOrder}},[e._v("添加售后单")])],1)],1)],1),a("ModifyAfterSalesOrder",{ref:"ModifyAfterSalesOrder"})],1)},r=[],s=(a("d9b9"),a("5e8c"),a("6bf8"),a("b916"),a("9b6f"),a("9bdd"),a("3231")),i=a("064d"),o=a("46d7"),l=a("631e"),u=a("4a81"),d=a("d11d"),c=a("a349"),p=a("4606"),R=function(e){Object(o["a"])(a,e);var t=Object(l["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.TemplateTypeDrop=[],e.TemplateList=[],e.TplType=0,e.InquiryReasonList=e.$Utils.GetEnumArr(e.$Enums.CustomerService.InquiryReasonList),e.HandleForm=new p["a"].HandleRefund,e.HandleType="SELLER_SEND_MESSAGE",e.Carrier={ShippingMethodId:0,Platform:0,ShippingCarrier:""},e}return Object(i["a"])(a,[{key:"EmitHandleSuccess",value:function(){}},{key:"EmitCancelModal",value:function(){}},{key:"WatchHandleType",value:function(e){this.$refs.HandleForm.resetFields()}},{key:"mounted",value:function(){this.TemplateTypeDrop.length||this.GetTemplateTypeDrop()}},{key:"GetTemplateTypeDrop",value:function(){var e=this;this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.GetTemplateTypeTree,Login:!0},Data:"",Callback:function(t){t.IsSuccess?(e.$set(e,"TemplateTypeDrop",t.Data.Data),e.GetTemplateList()):e.$Request.Error(t)}})}},{key:"GetTemplateList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.GetTemplateList,Login:!0},Data:{PageIndex:1,PageSize:500,Conditions:new p["a"].SearchMailTpl({TemplateTypeId:this.TplType})},Callback:function(a){t&&e.$UI.Loading.Hide(),a.IsSuccess?e.$set(e,"TemplateList",a.Data.PageModel.Items):e.$Request.Error(a)}})}},{key:"GetTemplateListLoading",value:function(){this.$UI.Loading.Show(),this.GetTemplateList(!0)}},{key:"RenderContent",value:function(e){var t=e.Content;if(this.SHIP_ORDER_INFO.Id){var a=this.$UI.Render.Date(this.SHIP_ORDER_INFO.ShipedTime,!0),n=this.$UI.Render.Date(this.SHIP_ORDER_INFO.PaidTime,!0);t=t.replace(/\[BuyerId\]/g,this.SHIP_ORDER_INFO.BuyerUserId),t=t.replace(/\[TrackingNumber\]/g,this.SHIP_ORDER_INFO.TrackingNumber||"[TrackingNumber]"),t=t.replace(/\[ShippingCarrier\]/g,this.SHIP_ORDER_INFO.ShippingService),t=t.replace(/\[ShipedTime\]/g,"-"===a?"[ShipedTime]":a),t=t.replace(/\[PaidTime\]/g,"-"===n?"[PaidTime]":n),t=t.replace(/\[ShipToAddress\]/g,"".concat(this.SHIP_ORDER_ADDRESS.BuyerStreet2?this.SHIP_ORDER_ADDRESS.BuyerStreet2+",":"").concat(this.SHIP_ORDER_ADDRESS.BuyerStreet1,",").concat(this.SHIP_ORDER_ADDRESS.BuyerCity,",").concat(this.SHIP_ORDER_ADDRESS.BuyerState,",").concat(this.SHIP_ORDER_ADDRESS.BuyerCountry,",").concat(this.SHIP_ORDER_ADDRESS.BuyerZipCode))}this.$set(this.HandleForm,"Content",t)}},{key:"Reset",value:function(){this.$set(this,"HandleForm",new p["a"].HandleRefund),this.$refs.HandleForm.resetFields(),this.$set(this,"HandleType","SELLER_SEND_MESSAGE"),this.$set(this,"TplType","")}},{key:"Validate",value:function(){var e=this;"RESEND"!==this.HandleType?!this.HandleType.includes("REFUND")||this.SHIP_ORDER_INFO.Id?this.$refs.HandleForm.validate((function(t){t&&e.PostHandle()})):this.$UI.Tips.Floating("warning","未关联发货订单，无法操作此项"):this.EmitCancelModal()}},{key:"PostHandle",value:function(){var e=this,t=JSON.parse(JSON.stringify(this.HandleForm)),a="";switch(t.ReturnId=this.REFUND_INFO.ReturnId,this.HandleType){case"SELLER_SEND_MESSAGE":delete t.TypeReason,delete t.Amount,delete t.Currency,a=this.$Api.ReturnReplyMessage;break;case"SELLER_ISSUE_REFUND":delete t.TypeReason,t.Amount=this.SHIP_ORDER_INFO.PayPrice,t.Currency=this.SHIP_ORDER_INFO.PayCurrency,a=this.$Api.ReturnFullRefund;break;case"SELLER_OFFER_PARTIAL_REFUND":if(t.Amount<=0)return void this.$UI.Tips.Floating("warning","请输入退款金额");if(t.Amount>this.SHIP_ORDER_INFO.PayPrice)return void this.$UI.Tips.Floating("warning","退款金额不能大于订单金额");t.Currency=this.SHIP_ORDER_INFO.PayCurrency,delete t.TypeReason,a=this.$Api.ReturnPartRefund;break;case"SELLER_DECLINE_REQUEST":delete t.TypeReason,delete t.Amount,delete t.Currency,a=this.$Api.ReturnRefuse;break;case"SELLER_ESCALATE":delete t.Amount,delete t.Currency,a=this.$Api.ReturnUpgradeCase;break}a&&(this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:a,Login:!0},Data:t,Callback:function(t){t.IsSuccess?(e.$UI.Tips.Floating("success","处理成功"),e.EmitHandleSuccess()):(e.$UI.Loading.Hide(),e.$Request.Error(t))}}))}},{key:"PostSelectNotRefund",value:function(e){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.ReSetSelectNoRefund,Login:!0},Data:new p["a"].RefundHandleNotRefund(this["REFUND_INFO"].ReturnId,e),Callback:function(a){t.$UI.Loading.Hide(),a.IsSuccess?t.$UI.Tips.Floating("success",e?"取消自动退款成功":"设置自动退款成功"):t.$Request.Error(a)}})}},{key:"TriggerAfterSalesOrder",value:function(){this.SHIP_ORDER_INFO.OrderCode?this.$refs.ModifyAfterSalesOrder.TriggerCreate(this.SHIP_ORDER_INFO.OrderCode):this.$UI.Tips.Floating("warning","不存在关联发货订单，无法添加售后单")}},{key:"REFUND_INFO",get:function(){return this["CustomerService/REFUND_INFO"]}},{key:"SHIP_ORDER_INFO",get:function(){return this["ShipOrder/SHIP_ORDER_INFO"]}},{key:"SHIP_ORDER_ADDRESS",get:function(){return this["ShipOrder/SHIP_ORDER_ADDRESS"]}}]),a}(d["d"]);u["a"]([c["b"]],R.prototype,"CustomerService/REFUND_INFO",void 0),u["a"]([c["b"]],R.prototype,"ShipOrder/SHIP_ORDER_INFO",void 0),u["a"]([c["b"]],R.prototype,"ShipOrder/SHIP_ORDER_ADDRESS",void 0),u["a"]([Object(d["b"])()],R.prototype,"EmitHandleSuccess",null),u["a"]([Object(d["b"])()],R.prototype,"EmitCancelModal",null),u["a"]([Object(d["e"])("HandleType")],R.prototype,"WatchHandleType",null),R=u["a"]([Object(d["a"])({name:"HandleRefund",components:{ModifyAfterSalesOrder:function(){return a.e("chunk-1d9ffbc2").then(a.bind(null,"3116"))}}})],R);var S=R,E=S,m=(a("1088"),a("4023")),h=Object(m["a"])(E,n,r,!1,null,"38dbad8e",null);t["default"]=h.exports},"88ce":function(e,t,a){}}]);