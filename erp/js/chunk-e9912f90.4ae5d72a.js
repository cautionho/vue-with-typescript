(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e9912f90"],{6947:function(t,e,a){"use strict";var r=a("ea6d0"),i=a.n(r);i.a},a4d2:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Row",{staticClass:"P-Inline-Block P-MR-10"},[a("Col",[a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.OpenModifyPuchaseApplyModal()}}},[t._v("添加采购申请")]),a("Modal",{attrs:{title:t.IsEdit?"编辑申请":"添加申请","mask-closable":!1,width:"1100"},on:{"on-cancel":function(e){return t.ClearModal(0)}},model:{value:t.ModifyModal,callback:function(e){t.ModifyModal=e},expression:"ModifyModal"}},[a("Row",[t.IsEdit?a("div",[a("Form",{ref:"OperateFormEdit",attrs:{"label-width":100,model:t.OperateFormEdit,rules:t.OperateFormEditRule,onsubmit:"return false"}},[a("Row",[a("Col",{attrs:{span:"18"}},[a("Col",{attrs:{span:"12"}},[a("Form-item",{staticClass:"P-MB-10",attrs:{label:"SKU编号："}},[t._v(" "+t._s(t.List[0].ApplySummarX.SkuCode)+" ")])],1),a("Col",{attrs:{span:"12"}},[a("Form-item",{staticClass:"P-MB-10",attrs:{label:"SKU名称："}},[t._v(" "+t._s(t.List[0].ApplySummarX.SkuName)+" ")])],1),a("Col",{attrs:{span:"12"}},[a("Form-item",{staticClass:"P-MB-10",attrs:{label:"当前库存："}},[t._v(" "+t._s(t.List[0].InventorX.Quantity)+" ")])],1),a("Col",{attrs:{span:"12"}},[a("Form-item",{staticClass:"P-MB-10",attrs:{label:"在途库存："}},[t._v(" "+t._s(t.List[0].InventorX.PurchasingQuantity)+" ")])],1),a("Col",{attrs:{span:"12"}},[a("Form-item",{staticClass:"P-MB-10",attrs:{label:"销售数据："}},[t._v(" "+t._s(t.List[0].AvgSaleQuantitX.AvgSaleQuantity7+"/"+t.List[0].AvgSaleQuantitX.AvgSaleQuantity15+"/"+t.List[0].AvgSaleQuantitX.AvgSaleQuantity30)+" ")])],1)],1),a("Col",{attrs:{span:"6"}},[a("div",{staticClass:"Detail-Picture",style:{background:"url("+t.$Server.File+"/"+t.List[0].ApplySummarX.DefaultImage+") no-repeat"}})])],1),a("Row",[a("Col",{attrs:{span:"12"}},[a("Form-item",{attrs:{label:"仓库：",prop:"WarehouseId"}},[a("Select",{attrs:{placeholder:"请选择仓库",options:t.DropWarehouseList},model:{value:t.OperateFormEdit.WarehouseId,callback:function(e){t.$set(t.OperateFormEdit,"WarehouseId",e)},expression:"OperateFormEdit.WarehouseId"}})],1)],1),a("Col",{attrs:{span:"12"}},[a("Form-item",{attrs:{label:"采购数量：",prop:"Quantity"}},[a("InputNumber",{staticClass:"P-W-100-Percent",attrs:{placeholder:"采购数量"},model:{value:t.OperateFormEdit.Quantity,callback:function(e){t.$set(t.OperateFormEdit,"Quantity",e)},expression:"OperateFormEdit.Quantity"}})],1)],1),a("Col",{attrs:{span:"24"}},[a("Form-item",{staticClass:"P-MB-10",attrs:{label:"备注："}},[a("Input",{attrs:{placeholder:"备注"},model:{value:t.OperateFormEdit.Remark,callback:function(e){t.$set(t.OperateFormEdit,"Remark",e)},expression:"OperateFormEdit.Remark"}})],1)],1)],1)],1)],1):a("div",[a("Form",{ref:"OperateForm",attrs:{"label-width":100,model:t.OperateForm,rules:t.OperateFormRule,onsubmit:"return false"}},[a("Form-item",{attrs:{label:"仓库：",prop:"WarehouseId"}},[a("Select",{attrs:{placeholder:"选择仓库",options:t.DropWarehouseList},model:{value:t.OperateForm.WarehouseId,callback:function(e){t.$set(t.OperateForm,"WarehouseId",e)},expression:"OperateForm.WarehouseId"}})],1)],1),a("h1",{staticClass:"P-TA-C"},[t._v("物品列表")]),a("Col",{staticClass:"P-MT-10",attrs:{span:"24"}},[a("Table",{ref:"ModifyPurchaseApply",attrs:{columns:t.Cols,data:t.List,size:"small",stripe:"",height:400}})],1)],1),a("Col",{staticClass:"P-MT-10 P-TA-R",attrs:{span:"24"}},[a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.OpenEnableSkuModal()}}},[t._v(t._s(t.IsEdit?"更换SKU":"添加SKU"))])],1)],1),a("footer",{staticClass:"P-TA-R",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.CheckData(!0)}}},[t._v("提交审核")]),a("Button",{attrs:{type:"primary"},on:{click:function(e){return t.CheckData(!1)}}},[t._v("提交")]),a("Button",{on:{click:function(e){return t.ClearModal(0)}}},[t._v("取消")])],1)],1)],1),a("EnableSku",{ref:"EnableSku",on:{"handle-res-msg":t.HandleSkuRes}})],1)},i=[],s=(a("d9b9"),a("cee1"),a("e8f2"),a("6bf8"),a("5c62")),o=a("3231"),n=a("064d"),l=a("46d7"),u=a("631e"),d=a("4a81"),p=a("d11d"),c=a("c638"),m=function(t){Object(l["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(o["a"])(this,a),t=e.apply(this,arguments),t.ModifyModal=!1,t.OperateForm=new c["a"].ModifyPurchaseApplySearch,t.OperateFormRule={WarehouseId:[{required:!0,message:"请选择仓库",trigger:"change",type:"number"}]},t.OperateFormEdit=new c["a"].ModifyPurchaseApplyEdit,t.OperateFormEditRule={WarehouseId:[{required:!0,message:"请选择仓库",trigger:"change",type:"number"}],Quantity:[{required:!0,message:"采购数量必须大于0",type:"number",min:1}]},t.ValidateForm="",t.GoodsData=[],t.SelectedData=[],t.List=[],t.Cols=[{title:"SKU编号",render:function(t,e){return t("span",e.row.ApplySummarX.SkuCode)}},{title:"名称",render:function(t,e){return t("span",e.row.InventorX.SkuName)}},{title:"当前库存",render:function(t,e){return t("span",e.row.InventorX.Quantity)}},{title:"在途库存",render:function(t,e){return t("span",e.row.InventorX.PurchasingQuantity)}},{title:"销量数据",render:function(t,e){return t("span",e.row.AvgSaleQuantitX.AvgSaleQuantity7+"/"+e.row.AvgSaleQuantitX.AvgSaleQuantity15+"/"+e.row.AvgSaleQuantitX.AvgSaleQuantity30)}},{title:"采购数量",render:function(e,a){return e("InputNumber",{props:{min:1,value:0},on:{input:function(e){t.List[a.row._index].ApplySummarX.Quantity=e}}})}},{title:"备注",render:function(e,a){return e("Input",{attrs:{placeholder:"请输入备注"},on:{input:function(e){t.List[a.row._index].ApplySummarX.Remark=e}},className:"w100"})}},{title:"操作",width:80,render:function(e,a){return e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.List.splice(a.row._index,1)}}},"删除")}}],t}return Object(n["a"])(a,[{key:"HandleResMsg",value:function(t){}},{key:"IsShowModal",value:function(t){t&&(this.IsEdit&&(this.List.push({ApplySummarX:this.SelectedEditData[0].ApplySummary,AvgSaleQuantitX:this.SelectedEditData[0].AvgSaleQuantity,InventorX:this.SelectedEditData[0].Inventory}),this.OperateFormEdit.WarehouseId=this.SelectedEditData[0].ApplySummary.ToWarehouseId,this.OperateFormEdit.Quantity=this.SelectedEditData[0].ApplySummary.PurchaseQuantity,this.OperateFormEdit.Remark=this.SelectedEditData[0].ApplySummary.Remark),this.ValidateForm=this.IsEdit?"OperateFormEdit":"OperateForm",this.$nextTick((function(){this.$set(this,"ModifyModal",!0)})))}},{key:"ClearModal",value:function(t){this.GoodsData.splice(0,this.GoodsData.length),this.SelectedData.splice(0,this.SelectedData.length),this.List.splice(0,this.List.length),this.$refs[this.ValidateForm].resetFields(),this.$set(this,"ModifyModal",!1),this.HandleResMsg(t)}},{key:"OpenModifyPuchaseApplyModal",value:function(){this.HandleResMsg(2)}},{key:"OpenEnableSkuModal",value:function(){var t=this;this.$refs[this.ValidateForm].validate((function(e){(e||"OperateFormEdit"===t.ValidateForm&&""!==t.OperateFormEdit.WarehouseId)&&t.$refs["EnableSku"].Trigger(t.IsEdit,"ModifyPurchaseApply")}))}},{key:"HandleSkuRes",value:function(t){if(this.SelectedData=t,this.IsEdit)this.OperateFormEdit.Quantity=0,this.OperateFormEdit.Remark="",t[0]["Remark"]="",t[0]["Quantity"]=0,this.List.length<1?this.GoodsData.push({ApplySummarX:t[0],AvgSaleQuantitX:{AvgSaleQuantity7:0,AvgSaleQuantity15:0,AvgSaleQuantity30:0,AvgSaleQuantity45:0,AvgSaleQuantity60:0},InventorX:""}):(this.List[0].ApplySummarX=t[0],this.$set(this,"GoodsData",JSON.parse(JSON.stringify(this.List))));else{for(var e in this.$set(this,"GoodsData",JSON.parse(JSON.stringify(this.List))),this.SelectedData)t[e]["Remark"]="",t[e]["Quantity"]=0,this.GoodsData.push({ApplySummarX:t[e],AvgSaleQuantitX:{AvgSaleQuantity7:0,AvgSaleQuantity15:0,AvgSaleQuantity30:0,AvgSaleQuantity45:0,AvgSaleQuantity60:0},InventorX:""});for(var a=this.GoodsData.length,r=0;r<a;r++)for(var i=r+1;i<a;i++)if(this.GoodsData[r].ApplySummarX.SkuCode==this.GoodsData[i].ApplySummarX.SkuCode){for(var s=0;s<this.SelectedData.length;s++)this.SelectedData[s].SkuCode==this.GoodsData[r].ApplySummarX.SkuCode&&this.SelectedData.splice(s,1);this.GoodsData.splice(i,1),i--,a--}}this.GetAvgSaleQuantity()}},{key:"GetAvgSaleQuantity",value:function(){var t=this;this.$UI.Loading.Show();var e=0,a=function(a){var r={SkuId:t.SelectedData[a].Id,WarehouseId:"OperateForm"===t.ValidateForm?t.OperateForm.WarehouseId:t.OperateFormEdit.WarehouseId},i=function(i){t.GoodsData[i].ApplySummarX.SkuCode==t.SelectedData[a].SkuCode&&t.$Request.Post({Server:t.$Server.Purchase,Api:{Address:t.$Api.GetSKUSaleQuantity,Login:!0},Data:r,Callback:function(r){1==r.IsSuccess?r.Data.Date.length>0&&(t.GoodsData[i].AvgSaleQuantitX.AvgSaleQuantity7=r.Data.Date[0].Qty,t.GoodsData[i].AvgSaleQuantitX.AvgSaleQuantity15=r.Data.Date[1].Qty,t.GoodsData[i].AvgSaleQuantitX.AvgSaleQuantity30=r.Data.Date[2].Qty):t.$Request.Error(r);var o={SkuCode:t.SelectedData[a].SkuCode,WarehouseId:"OperateForm"===t.ValidateForm?t.OperateForm.WarehouseId:t.OperateFormEdit.WarehouseId};t.$Request.Post({Server:t.$Server.Warehouse,Api:{Address:t.$Api.InventoryGetSkuInventory,Login:!0},Data:o,Callback:function(r){var o;(Number(a)===t.SelectedData.length-1&&Number(i)===t.GoodsData.length-1&&t.$UI.Loading.Hide(),1==r.IsSuccess?t.GoodsData[i].InventorX=r.Data.Data:t.$Request.Error(r),e++,e>=t.SelectedData.length)&&(e=0,(o=t.List).splice.apply(o,[0,t.List.length].concat(Object(s["a"])(t.GoodsData))))}})}})};for(var o in t.GoodsData)i(o)};for(var r in this.SelectedData)a(r)}},{key:"CheckData",value:function(t){var e=this;this.$refs[this.ValidateForm].validate((function(a){if(a){if(e.IsEdit)e.List[0].ApplySummarX.Remark=e.OperateFormEdit.Remark,e.List[0].ApplySummarX.Quantity=e.OperateFormEdit.Quantity;else{if(e.List.length<1)return void e.$UI.Tips.Floating("warning","请选择SKU");for(var r=e.List.length,i=0;i<r;i++)if(e.List[i].ApplySummarX.Quantity<1||""==e.List[i].ApplySummarX.Quantity)return void e.$UI.Tips.Floating("warning","请输入【".concat(e.List[i].ApplySummarX.SkuCode,"】的采购数量"))}e.PostAjax(t)}}))}},{key:"PostAjax",value:function(t){for(var e=this,a=this.IsEdit?this.$Api.PurchaseApplyModify:this.$Api.PurchaseApplyCreate,r=t?this.IsEdit?"编辑并提交审核成功":"添加并提交审核成功":this.IsEdit?"编辑成功":"添加成功",i=[],s=(this.List.length,0);s<this.List.length;s++){var o={Id:0,SkuCode:this.List[s].ApplySummarX.SkuCode,WarehouseId:"OperateForm"===this.ValidateForm?this.OperateForm.WarehouseId:this.OperateFormEdit.WarehouseId,Quantity:this.List[s].ApplySummarX.Quantity,Remark:this.List[s].ApplySummarX.Remark};i.push(o),this.IsEdit?i[s].Id=this.SelectedEditData[0].ApplySummary.Id:delete i[s].Id}var n={Model:this.IsEdit?i[0]:i,IsSubmit:t};this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:a,Login:!0},Data:n,Callback:function(t){t.IsSuccess?(e.$UI.Tips.Floating("success",r),e.ClearModal(1)):(e.$UI.Loading.Hide(),e.$Request.Error(t))}})}}]),a}(p["d"]);d["a"]([Object(p["c"])()],m.prototype,"IsEdit",void 0),d["a"]([Object(p["c"])()],m.prototype,"DropWarehouseList",void 0),d["a"]([Object(p["c"])()],m.prototype,"ShowModal",void 0),d["a"]([Object(p["c"])()],m.prototype,"SelectedEditData",void 0),d["a"]([Object(p["b"])()],m.prototype,"HandleResMsg",null),d["a"]([Object(p["e"])("ShowModal")],m.prototype,"IsShowModal",null),m=d["a"]([Object(p["a"])({name:"ModifyPurchaseApply",components:{EnableSku:function(){return a.e("chunk-2d0dd9de").then(a.bind(null,"81c2"))}}})],m);var h=m,S=h,y=(a("6947"),a("4023")),v=Object(y["a"])(S,r,i,!1,null,"6eb74159",null);e["default"]=v.exports},ea6d0:function(t,e,a){}}]);