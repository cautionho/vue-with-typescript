(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0abded"],{"16b4":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Col",[r("Button",{attrs:{type:"primary"},on:{click:e.Trigger}},[e._v("导出发货单")]),r("Modal",{attrs:{title:"导出发货单"},on:{"on-cancel":e.CancelModal},model:{value:e.ExportModal,callback:function(t){e.ExportModal=t},expression:"ExportModal"}},[e.IsExportShiped?r("Form",{ref:"ExportShiped",attrs:{model:e.ExportShiped,rules:e.ExportRules,"label-width":100,onsubmit:"return false;"}},[r("FormItem",{attrs:{label:"发货时间：",prop:"StartTime"}},[r("DatePicker",{staticClass:"P-W-100-Percent",attrs:{type:"datetime",placeholder:"开始时间"},model:{value:e.ExportShiped.StartTime,callback:function(t){e.$set(e.ExportShiped,"StartTime",t)},expression:"ExportShiped.StartTime"}})],1),r("FormItem",{attrs:{label:"",prop:"EndTime"}},[r("DatePicker",{staticClass:"P-W-100-Percent",attrs:{type:"datetime",placeholder:"结束时间"},model:{value:e.ExportShiped.EndTime,callback:function(t){e.$set(e.ExportShiped,"EndTime",t)},expression:"ExportShiped.EndTime"}})],1),r("FormItem",{attrs:{label:"发货仓："}},[r("Select",{attrs:{placeholder:"发货仓",options:e.WarehouseDrop},model:{value:e.ExportShiped.ShipWarehouseId,callback:function(t){e.$set(e.ExportShiped,"ShipWarehouseId",t)},expression:"ExportShiped.ShipWarehouseId"}})],1),r("FormItem",{attrs:{label:"平台："}},[r("Select",{attrs:{placeholder:"平台",options:e.PlatformDrop,onChange:e.GetStoreDrop},model:{value:e.ExportShiped.Platform,callback:function(t){e.$set(e.ExportShiped,"Platform",t)},expression:"ExportShiped.Platform"}})],1),r("FormItem",{attrs:{label:"店铺："}},[r("Select",{attrs:{placeholder:"店铺",options:e.StoreDrop},model:{value:e.ExportShiped.StoreId,callback:function(t){e.$set(e.ExportShiped,"StoreId",t)},expression:"ExportShiped.StoreId"}})],1),r("FormItem",{attrs:{label:"国家："}},[r("Select",{attrs:{placeholder:"国家",options:e.COUNTRY_DROP,optionValKey:"CountryCode",optionKey:"CountryNameCn"},model:{value:e.ExportShiped.Country,callback:function(t){e.$set(e.ExportShiped,"Country",t)},expression:"ExportShiped.Country"}})],1),r("FormItem",{attrs:{label:"物流渠道："}},[r("Select",{attrs:{placeholder:"物流渠道",options:e.MethodDrop,optionValKey:"Id",optionKey:"Name",multiple:""},model:{value:e.ExportShiped.ShipMethodId,callback:function(t){e.$set(e.ExportShiped,"ShipMethodId",t)},expression:"ExportShiped.ShipMethodId"}})],1),r("FormItem",{attrs:{label:"导出明细：",prop:"ExportType"}},[r("Select",{attrs:{placeholder:"导出明细",options:e.ExportItemTypeDrop},model:{value:e.ExportShiped.ExportType,callback:function(t){e.$set(e.ExportShiped,"ExportType",t)},expression:"ExportShiped.ExportType"}})],1)],1):r("Form",{ref:"ExportOrder",attrs:{model:e.ExportOrder,rules:e.ExportOrderRules,"label-width":80,onsubmit:"return false;"}},[r("FormItem",{attrs:{label:"发货仓：",prop:"WarehouseId"}},[r("Select",{attrs:{placeholder:"发货仓",options:e.WarehouseDrop},model:{value:e.ExportOrder.WarehouseId,callback:function(t){e.$set(e.ExportOrder,"WarehouseId",t)},expression:"ExportOrder.WarehouseId"}})],1)],1),r("footer",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.Validate}},[e._v("导出")]),r("Button",{on:{click:e.CancelModal}},[e._v("取消")])],1)],1)],1)},i=[],a=(r("6bf8"),r("b449"),r("5d83")),s=r("3231"),p=r("064d"),n=r("46d7"),l=r("631e"),d=r("4a81"),h=r("d11d"),u=r("a349"),c=r("1459"),S=function(e){Object(n["a"])(r,e);var t=Object(l["a"])(r);function r(){var e;return Object(s["a"])(this,r),e=t.apply(this,arguments),e.ExportModal=!1,e.IsExportShiped=!1,e.PlatformDrop=e.$Utils.GetEnumArr(e.$Enums.Sales.Platform),e.ExportItemTypeDrop=e.$Utils.GetEnumArr(e.$Enums.Warehouse.ExportItemType),e.WarehouseDrop=[],e.MethodDrop=[],e.StoreDrop=[],e.ExportShiped=new c["a"].ExportShiped,e.ExportOrder=new c["a"].ExportOrder,e.ExportRules={StartTime:[{required:!0,message:"请选择开始时间"}],EndTime:[{required:!0,message:"请选择结束时间"}],ExportType:[{required:!0,message:"请选择导出明细",trigger:"change",type:"number"}]},e.ExportOrderRules={WarehouseId:[{required:!0,message:"请选择发货仓",trigger:"change",type:"number"}]},e}return Object(p["a"])(r,[{key:"EmitOperateSuccess",value:function(){}},{key:"GetDropList",value:function(e,t,r){var o=this;return new Promise((function(i){o.$Request.Post({Server:e,Api:{Address:t},Data:r,Callback:function(e){e.IsSuccess||o.$Request.Error(e),i(e.Data.DropList||[])}})}))}},{key:"GetDrops",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=this,e.t1=this,e.next=4,this.GetDropList(this.$Server.Settings,this.$Api.GetWarehouseDropList,!0);case 4:if(e.t2=e.sent,e.t0.$set.call(e.t0,e.t1,"WarehouseDrop",e.t2),!this.IsExportShiped){e.next=13;break}return e.t3=this,e.t4=this,e.next=11,this.GetDropList(this.$Server.Logistics,this.$Api.ChannelDropList,0);case 11:e.t5=e.sent,e.t3.$set.call(e.t3,e.t4,"MethodDrop",e.t5);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"GetStoreDrop",value:function(e){var t=this;e?this.GetDropList(this.$Server.Sales,this.$Api.Sales[String(e)].StoreDrop,"").then((function(e){t.$set(t,"StoreDrop",e)})):(this.$set(this,"StoreDrop",[]),this.ExportShiped.StoreId=0)}},{key:"Trigger",value:function(){this.$set(this,"ExportModal",!0),this.$set(this,"IsExportShiped","Shiped"===this.Page),this.WarehouseDrop.length||this.GetDrops()}},{key:"Validate",value:function(){this.IsExportShiped?this.ValidateExportShiped():this.ValidateExport()}},{key:"ValidateExportShiped",value:function(){var e=this;this.$refs.ExportShiped.validate((function(t){if(t){var r=JSON.parse(JSON.stringify(e.ExportShiped)),o=+new Date(r.StartTime),i=+new Date(r.EndTime);if(o>i)return void e.$UI.Tips.Floating("warning","开始时间不能晚于结束时间");if(i-o>26784e5)return void e.$UI.Tips.Floating("warning","发货时间区间不能超过31天");r.StartTime=e.$UI.Render.NewDate(r.StartTime),r.EndTime=e.$UI.Render.NewDate(r.EndTime),e.PostExport(r)}}))}},{key:"ValidateExport",value:function(){var e=this;this.$refs.ExportOrder.validate((function(t){if(t){var r=JSON.parse(JSON.stringify(e.ExportOrder));r.ExportType="WaitPick"===e.Page?3:"Picked"===e.Page?4:"Packed"===e.Page?5:0,e.PostExport(r)}}))}},{key:"PostExport",value:function(e){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Warehouse,Api:{Address:this.IsExportShiped?this.$Api.ExportHasConfirmShipOrders:this.$Api.ExportHasOperationShipOrders,Login:!0},Data:e,Callback:function(e){t.$UI.Loading.Hide(),e.IsSuccess?(t.CancelModal(),setTimeout((function(){t.$UI.Tips.Modal({Type:"success",Content:"创建导出发货订单任务成功。请到报表-导出管理模块查看目前正在进行的导出任务，并在导出成功后可以下载对应数据。"})}),500)):t.$Request.Error(e)}})}},{key:"CancelModal",value:function(){this.$set(this,"ExportModal",!1),this.IsExportShiped?(this.$set(this,"ExportShiped",new c["a"].ExportShiped),this.$refs.ExportShiped.resetFields()):(this.$set(this,"ExportOrder",new c["a"].ExportOrder),this.$refs.ExportOrder.resetFields())}},{key:"COUNTRY_DROP",get:function(){return this["Base/COUNTRY_DROP"]}}]),r}(h["d"]);d["a"]([Object(h["c"])(String)],S.prototype,"Page",void 0),d["a"]([Object(h["b"])()],S.prototype,"EmitOperateSuccess",null),d["a"]([u["b"]],S.prototype,"Base/COUNTRY_DROP",void 0),S=d["a"]([Object(h["a"])({name:"ExportShipOrder"})],S);var E=S,x=E,m=r("4023"),f=Object(m["a"])(x,o,i,!1,null,null,null);t["default"]=f.exports}}]);