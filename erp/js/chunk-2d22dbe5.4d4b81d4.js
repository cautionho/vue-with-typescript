(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22dbe5"],{f995:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Modal",{staticClass:"Container-Tabs",attrs:{title:t.ModalTitle,width:1e3},on:{"on-cancel":t.CancelModal},model:{value:t.EmailModal,callback:function(e){t.EmailModal=e},expression:"EmailModal"}},[i("Form",{ref:"WriteEmailForm",attrs:{model:t.WriteEmailForm,rules:t.WriteEmailRules,"label-width":90,onsubmit:"return false"}},[i("Tabs",{attrs:{name:"WriteEmailTabs",type:"card"},on:{click:t.ChangeTabs},model:{value:t.Tabs,callback:function(e){t.Tabs=e},expression:"Tabs"}},[i("TabPane",{attrs:{label:"基本信息",name:"Base",tab:"WriteEmailTabs"}},[t.Type<7?i("FormItem",{attrs:{label:"发件人：",prop:"FromAccount",rules:{required:!0,message:"请选择发件人",trigger:"change"}}},[t.Type<2?i("Select",{attrs:{placeholder:"发件人",options:t.EmailAccounts,transfer:""},model:{value:t.WriteEmailForm.FromAccount,callback:function(e){t.$set(t.WriteEmailForm,"FromAccount",e)},expression:"WriteEmailForm.FromAccount"}}):i("span",[t._v(" "+t._s(t.WriteEmailForm.FromAccount)+" ")])],1):t._e(),t.Type<7?i("FormItem",{attrs:{label:"收件人：",prop:"ToAccounts",rules:{required:!0,message:"请输入收件人，多个地址之间请使用英文逗号隔开",validator:this.ValidateEmails}}},[i("Input",{attrs:{placeholder:"收件人"},model:{value:t.WriteEmailForm.ToAccounts,callback:function(e){t.$set(t.WriteEmailForm,"ToAccounts",e)},expression:"WriteEmailForm.ToAccounts"}})],1):t._e(),t.Type<7?i("FormItem",{attrs:{label:"抄送：",prop:"CCAccounts",rules:{required:!1,message:"请输入正确格式的抄送邮箱地址，多个地址之间请使用英文逗号隔开",validator:this.ValidateEmails}}},[i("Input",{attrs:{placeholder:"多个抄送请使用英文逗号隔开"},model:{value:t.WriteEmailForm.CCAccounts,callback:function(e){t.$set(t.WriteEmailForm,"CCAccounts",e)},expression:"WriteEmailForm.CCAccounts"}})],1):t._e(),i("FormItem",{attrs:{label:"主题：",prop:"Title"}},[i("Input",{attrs:{placeholder:"主题"},model:{value:t.WriteEmailForm.Title,callback:function(e){t.$set(t.WriteEmailForm,"Title",e)},expression:"WriteEmailForm.Title"}})],1),i("FormItem",{attrs:{label:"正文：",required:""}},[i("Cascader",{attrs:{placeholder:"模板",data:t.Tpl,clearable:"",filterable:""},on:{"on-change":t.ChangeContent}})],1),i("FormItem",[i("Jodit",{ref:"Editor"})],1)],1),i("TabPane",{attrs:{label:"附件信息",name:"Attachment",tab:"WriteEmailTabs"}},[i("FormItem",{attrs:{label:"附件："}},[i("Upload",{directives:[{name:"show",rawName:"v-show",value:t.WriteEmailForm.Attachments.length<5,expression:"WriteEmailForm.Attachments.length < 5"}],attrs:{multiple:"",type:"drag",action:t.UploadFileApi,headers:t.$Request.Headers({Server:"",Api:{Address:"",Login:!0},Data:"",Form:!0}),"show-upload-list":!1,"on-success":t.HandleUploadSuccess,format:["rar","zip","jpg","png","jpeg","gif","bmp","docx","doc","pdf","xps","xml"],"max-size":10240,"on-format-error":t.HandleFormatError,"on-exceeded-size":t.HandleMaxSize,"before-upload":t.HandleBeforeUpload}},[i("div",{staticStyle:{padding:"14px 0"}},[i("Icon",{attrs:{type:"ios-cloud-upload",size:"26"}}),i("p",[t._v("点击或拖拽文件到此处（最多上传5个每个大小不超过10M的附件）")])],1)]),i("ul",t._l(t.WriteEmailForm.Attachments,(function(e,a){return i("li",{key:a,staticStyle:{"border-bottom":"1px dashed #ccc","list-style":"none"}},[t._v(" "+t._s(e.FileName)+" "),i("Icon",{staticClass:"P-Float-Right P-Pointer P-MR-10",staticStyle:{"line-height":"32px"},attrs:{size:"16",color:"red",type:"md-close"},on:{click:function(e){return t.UploaderDel(a)}}}),i("span",{staticClass:"P-Float-Right P-Inline-Block P-W-100"},[t._v(t._s(e.FileSize))])],1)})),0)],1)],1)],1)],1),i("footer",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"primary"},on:{click:t.Validate}},[t._v("提交")]),i("Button",{on:{click:t.CancelModal}},[t._v("取消")])],1)],1)},r=[],o=(i("d9b9"),i("6412"),i("02cc"),i("9660"),i("5f3d"),i("5e8c"),i("5d9d"),i("0a9c"),i("76bb"),i("cee1"),i("1ff3"),i("6bf8"),i("b916"),i("7623"),i("522a"),i("d088"),i("0b78"),i("52af"),i("b449"),i("5d83")),s=i("e24e"),l=i("3231"),n=i("064d"),c=i("46d7"),m=i("631e"),u=i("4a81"),p=i("d11d"),d=i("4606"),h=function(t){Object(c["a"])(i,t);var e=Object(m["a"])(i);function i(){var t;return Object(l["a"])(this,i),t=e.apply(this,arguments),t.EmailModal=!1,t.ModalTitle="",t.Tabs="Base",t.Type=0,t.EmailAccounts=[],t.UploadFileApi="".concat(t.$Server.Settings).concat(t.$Api.UploadDocFile),t.Tpl=[],t.WriteEmailTabs="Base",t.WriteEmailForm=new d["a"].WriteEmail,t.UploadQty=0,t.WriteEmailRules={Title:[{required:!0,message:"请输入主题"}]},t}return Object(n["a"])(i,[{key:"EmitHandleSuccess",value:function(){}},{key:"AccountWatcher",value:function(t){this.EmailAccounts=[];var e,i=Object(s["a"])(t);try{for(i.s();!(e=i.n()).done;){var a=e.value,r=a.Name,o=a.Account;this.EmailAccounts.push({Key:"".concat(r,"(").concat(o,")"),Value:"".concat(r,"-").concat(o)})}}catch(l){i.e(l)}finally{i.f()}}},{key:"Trigger",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new d["a"].EmailDetails,i=arguments.length>2?arguments[2]:void 0;this.$set(this,"EmailModal",!0),this.$set(this,"Type",t),t>1&&(this.$set(this,"WriteEmailForm",JSON.parse(JSON.stringify(e))),this.SetWriteEmail(JSON.parse(JSON.stringify(e)),i)),this.SetModalTitle()}},{key:"TriggerWrite",value:function(t){this.$set(this,"EmailModal",!0),this.$set(this,"Type",1),this.$set(this.WriteEmailForm,"ToAccounts",t),this.SetModalTitle()}},{key:"TriggerLogisticsWrite",value:function(t){this.$set(this,"EmailModal",!0),this.$set(this,"Type",7),this.$set(this.WriteEmailForm,"ShipOrderCodes",t.map((function(t){return t.Id}))),this.SetModalTitle()}},{key:"SetModalTitle",value:function(){this.$set(this,"ModalTitle",[1,7].includes(this.Type)?"写邮件":this.Type<4?"回复邮件":"转发"),this.Tpl.length||this.GetEmailTpls()}},{key:"SetWriteEmail",value:function(t,e){var i=this;switch(this.$set(this.WriteEmailForm,"FromAccount",e.Account),this.WriteEmailForm["OldEmailRecordId"]=t.Id,this.Type){case 2:this.$set(this.WriteEmailForm,"Title","Re: ".concat(t.Title)),this.$set(this.WriteEmailForm,"ToAccounts",t.ReplyTo||t.FromAccount),this.$set(this.WriteEmailForm,"Attachments",[]);break;case 3:this.$set(this.WriteEmailForm,"Title","RE: ".concat(t.Title));var a=Array.from(new Set([t.FromAccount].concat([t.ToAccounts,t.ReplyTo],t.CCAccounts.split(",")))).filter((function(t){return""!==t})),r=a.indexOf(this.WriteEmailForm.FromAccount);r>=0&&a.splice(r,1),this.$set(this.WriteEmailForm,"ToAccounts",a.join(",")),this.$set(this.WriteEmailForm,"Attachments",[]);break;case 6:this.$set(this.WriteEmailForm,"Title","Fw: ".concat(t.Title)),this.$set(this.WriteEmailForm,"ToAccounts","");break}this.$set(this.WriteEmailForm,"Content",'<p><br></p><p><br></p><p><br></p>\n    <p>------------------------------------------------------------original------------------------------------------------------------<br></p>\n    <div style="background: rgb(241, 241, 241); font-size: 12px; width:100%; padding: 6px;margin-bottom: 6px; line-height:14px;">\n      <p><b>From: </b>'.concat(t.FromAccount,"</p>\n      <p><b>To: </b>").concat(t.ToAccounts,"</p>\n      <p><b>Reply-To: </b>").concat(t.ReplyTo||"-","</p>\n      <p><b>Cc: </b>").concat(t.CCAccounts||"-","</p>\n      <p><b>Date: </b>").concat(this.$UI.Render.Date(t.EmailTime,!0),"</p>\n      <p><b>Subject: </b>").concat(t.Title,"</p>\n    </div>\n    ").concat(t.Content)),this.$nextTick((function(){i.$refs.Editor.SetContent(i.WriteEmailForm.Content)}))}},{key:"GetEmailTpls",value:function(){var t=this;this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.GetEmailTemplateTypeDrop,Login:!0},Data:"",Callback:function(e){e.IsSuccess?t.SetTplCascader(e.Data.Data):t.$Request.Error(e)}})}},{key:"SetTplCascader",value:function(t){var e=this;t.forEach(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(i,a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=e.Tpl,t.t1=a,t.t2=i.TypeName,t.next=5,e.GetTpl(i.TypeId,a);case 5:t.t3=t.sent,t.t4={value:t.t1,label:t.t2,children:t.t3},t.t0.push.call(t.t0,t.t4);case 8:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}())}},{key:"GetTpl",value:function(t,e){var i=this;return new Promise((function(a){i.$Request.Post({Server:i.$Server.CustomerService,Api:{Address:i.$Api.EmailTemplateDropList,Login:!0},Data:t,Callback:function(t){t.IsSuccess?a(t.Data.Data.map((function(t,i){return{label:t.Title,value:"".concat(e,"-").concat(i),content:t.Content}}))):(a([]),i.$Request.Error(t))}})}))}},{key:"ChangeContent",value:function(t){if(t.length){var e=this.Tpl[t[0]].children.filter((function(e){return e.value===t[1]}))[0],i=e?e.content:"";this.$refs.Editor.InsertCtn(i)}}},{key:"Validate",value:function(){var t=this;this.$refs.WriteEmailForm.validate((function(e){if(e){if(!t.$refs.Editor.GetContent())return void t.$UI.Tips.Floating("warning","请输入正文内容");t.$set(t.WriteEmailForm,"Content",t.$refs.Editor.GetContent()),t.PostSendEmail()}}))}},{key:"PostSendEmail",value:function(){var t=this,e=JSON.parse(JSON.stringify(this.WriteEmailForm));1===this.Type&&(e.FromName=e.FromAccount.split("-")[0],e.FromAccount=e.FromAccount.split("-")[1]),this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:1===this.Type?this.$Api.EmailRecordWrite:2===this.Type?this.$Api.EmailRecordReply:3===this.Type?this.$Api.EmailRecordReplyAll:6===this.Type?this.$Api.EmailRecordForward:7===this.Type?this.$Api.BatchSendEmail:"",Login:!0},Data:e,Callback:function(e){e.IsSuccess?7===t.Type?(t.$UI.Loading.Hide(),t.$UI.Tips.Modal({Type:e.Data.IsAllSuccess?"success":"error",Content:"".concat(e.Data.ResultContent,"。").concat(e.Data.IsAllSuccess?"":'<a href="'+t.$Server.CustomerService+e.Data.Url+'" download>下载邮件发送失败订单表格</a>'),Callback:function(i){e.Data.IsAllSuccess&&(t.CancelModal(),t.EmitHandleSuccess())}})):(t.$UI.Tips.Floating("success",1===t.Type?"发送成功":t.Type<4?"回复成功":"转发成功"),t.EmitHandleSuccess(),t.CancelModal()):(t.$UI.Loading.Hide(),t.$Request.Error(e))}})}},{key:"HandleUploadSuccess",value:function(t,e,i){if(t.IsSuccess){var a={FileName:e.name,FileSize:t.Data.Size,DownloadUrl:"".concat(this.$Server.File,"/").concat(t.Data.Url)};this.WriteEmailForm.Attachments.push(a)}else this.$Request.Error(t);this.CountUploadQty()}},{key:"HandleFormatError",value:function(t){this.$UI.Tips.Floating("warning","文件[".concat(t.name,"]格式不为rar/zip/jpg/png/jpeg/gif/bmp/docx/doc/pdf/xps/xml'，请检查")),this.CountUploadQty()}},{key:"HandleMaxSize",value:function(t,e){this.$UI.Tips.Floating("warning","文件".concat(t.name,"大小超过2M，请检查")),this.CountUploadQty()}},{key:"HandleBeforeUpload",value:function(t){if(0===this.UploadQty&&this.$UI.Loading.Show(),this.UploadQty+this.WriteEmailForm.Attachments.length>=5)return!1;this.UploadQty++}},{key:"CountUploadQty",value:function(){this.UploadQty--,this.UploadQty<=0&&this.$UI.Loading.Hide()}},{key:"UploaderDel",value:function(t){this.WriteEmailForm.Attachments.splice(t,1)}},{key:"ChangeTabs",value:function(t){this.$set(this,"Tabs",t)}},{key:"CancelModal",value:function(){var t=this;this.$set(this,"EmailModal",!1),this.$set(this,"ModalTitle",""),this.$set(this,"UploadQty",0),this.$set(this,"Type",0),this.$set(this,"WriteEmailForm",new d["a"].WriteEmail),this.$refs.Editor.SetContent(""),this.$nextTick((function(){t.$refs.WriteEmailForm.resetFields(),t.$set(t,"Tabs","Base")}))}},{key:"ValidateEmails",value:function(t,e,i){var a=this;if(e){var r=e.split(",");return r.every((function(t){return a.$Pattern.Email.test(t)}))}return!t.required}}]),i}(p["d"]);u["a"]([Object(p["b"])()],h.prototype,"EmitHandleSuccess",null),u["a"]([Object(p["c"])(Array)],h.prototype,"Accounts",void 0),u["a"]([Object(p["e"])("Accounts")],h.prototype,"AccountWatcher",null),h=u["a"]([Object(p["a"])({name:"WriteMail",components:{Jodit:function(){return i.e("chunk-0804eda8").then(i.bind(null,"bf42"))}}})],h);var f=h,E=f,T=i("4023"),b=Object(T["a"])(E,a,r,!1,null,"56cbb14e",null);e["default"]=b.exports}}]);