(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22d5d3"],{f6d1:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("Row",{staticClass:"P-Inline-Block"},[o("Col",[o("Button",{staticClass:"P-Inline-Block P-MR-10",attrs:{type:"primary"},on:{click:function(e){return t.OpenScanInStorageModal()}}},[t._v("扫描入库")]),o("Modal",{attrs:{title:"扫描入库","mask-closable":!1,width:"800"},on:{"on-cancel":function(e){return t.ClearModal(0)}},model:{value:t.ModifyModal,callback:function(e){t.ModifyModal=e},expression:"ModifyModal"}},[o("Form",{ref:"InStorageForm",attrs:{"label-width":150,model:t.InStorageForm,rules:t.InStorageRule,inline:"",onsubmit:"return false"}},[o("Form-item",{staticClass:"P-MB-10 P-W-100-Percent",attrs:{label:"到货单号：",prop:"OrderCode"}},[o("Input",{ref:"InStorageOrderCodeInput",attrs:{placeholder:"到货单号"},on:{"on-enter":t.GetPaoItems},model:{value:t.InStorageForm.OrderCode,callback:function(e){t.$set(t.InStorageForm,"OrderCode","string"===typeof e?e.trim():e)},expression:"InStorageForm.OrderCode"}}),o("p",{staticClass:"Color-Gray"},[t._v("请扫描/输入到货单号，输入完成后请按回车键。")])],1),o("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"产品名称："}},[o("span",[t._v(t._s(t.InStorageForm.SkuName?t.InStorageForm.SkuName:"-"))])]),o("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"发货仓入库数量：",prop:"InStorageQuantity"}},[o("InputNumber",{ref:"InStorageQuantityInput",staticClass:"P-W-100-Percent",attrs:{placeholder:"发货仓入库数量"},on:{"on-enter":function(e){return t.PostInStorage("Num1")}},model:{value:t.InStorageForm.InStorageQuantity,callback:function(e){t.$set(t.InStorageForm,"InStorageQuantity",e)},expression:"InStorageForm.InStorageQuantity"}})],1),o("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"发货仓货架号：",prop:"LocationCode"}},[o("Input",{ref:"InStorageLocationCodeInput",attrs:{placeholder:"发货仓货架号",readonly:t.ReadonlyLocation1},on:{"on-enter":function(e){return t.PostInStorage("Location1")}},model:{value:t.InStorageForm.LocationCode,callback:function(e){t.$set(t.InStorageForm,"LocationCode","string"===typeof e?e.trim():e)},expression:"InStorageForm.LocationCode"}})],1),o("Checkbox",{staticClass:"P-MB-10 P-ML-20",model:{value:t.IsOpen,callback:function(e){t.IsOpen=e},expression:"IsOpen"}},[t._v("主货架货位不足开启备用货架")]),t.IsOpen?o("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"备货仓入库数量：",prop:"InStorageQuantity2"}},[o("InputNumber",{ref:"InStorageQuantity2Input",staticClass:"P-W-100-Percent",attrs:{placeholder:"备货仓入库数量"},on:{"on-enter":function(e){return t.PostInStorage("Num2")}},model:{value:t.InStorageForm.InStorageQuantity2,callback:function(e){t.$set(t.InStorageForm,"InStorageQuantity2",e)},expression:"InStorageForm.InStorageQuantity2"}})],1):t._e(),t.IsOpen?o("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"备货仓货架号：",prop:"LocationCode2"}},[o("Input",{ref:"InStorageLocationCode2Input",attrs:{placeholder:"备货仓货架号",readonly:t.ReadonlyLocation2},on:{"on-enter":function(e){return t.PostInStorage("Location2")}},model:{value:t.InStorageForm.LocationCode2,callback:function(e){t.$set(t.InStorageForm,"LocationCode2","string"===typeof e?e.trim():e)},expression:"InStorageForm.LocationCode2"}})],1):t._e()],1),o("footer",{staticClass:"P-TA-R",attrs:{slot:"footer"},slot:"footer"},[o("Button",{attrs:{type:"primary"},on:{click:t.PostInStorage}},[t._v("提交")]),o("Button",{on:{click:t.ResetInStorageForm}},[t._v("重置")])],1)],1)],1)],1)},n=[],r=(o("d9b9"),o("e8f2"),o("3231")),i=o("064d"),s=o("46d7"),u=o("631e"),I=o("4a81"),c=o("d11d"),d=o("c638"),g=function(t){Object(s["a"])(o,t);var e=Object(u["a"])(o);function o(){var t;return Object(r["a"])(this,o),t=e.apply(this,arguments),t.SelecData=[],t.ModifyModal=!1,t.IsOpen=!1,t.IsGetPao=!1,t.WaitInStorageQuantity=0,t.InStorageForm=new d["a"].InStorageForm,t.ReadonlyLocation1=!1,t.ReadonlyLocation2=!1,t.SkuId=0,t.SkuCode="",t.StockUpWarehouseId=0,t.InStorageRule={OrderCode:[{required:!0,message:" "}],InStorageQuantity:[{required:!0,min:1,type:"number",message:"请输入发货仓入库数"}],LocationCode:[{required:!0,message:"请输入发货仓货架号"},{pattern:t.$Pattern.LocationCode,message:"请输入正确的发货仓货架号"}],InStorageQuantity2:[{required:!0,min:1,type:"number",message:"请输入备货仓入库数"}],LocationCode2:[{required:!0,message:"请输入备货仓货架号"},{pattern:t.$Pattern.LocationCode,message:"请输入正确的备货仓货架号"}]},t}return Object(i["a"])(o,[{key:"HandleResMsg",value:function(t){}},{key:"Trigger",value:function(t){var e=this;this.InStorageForm.OrderCode=t[0].OrderCode,this.GetPaoItems(),this.$nextTick((function(){e.ModifyModal=!0}))}},{key:"IsOpenLocationCode",value:function(t){t&&0!==this.SkuId?this.GetSpare():this.InStorageForm.LocationCode2="",this.IsGetPao?t?this.$nextTick((function(){this.$refs.InStorageQuantityInput.focus()})):this.$refs.InStorageQuantityInput.focus():this.$refs.InStorageOrderCodeInput.focus()}},{key:"OpenScanInStorageModal",value:function(){var t=this;this.HandleResMsg(0),this.ModifyModal=!0,this.$nextTick((function(){t.$refs["InStorageForm"].resetFields(),t.$refs.InStorageOrderCodeInput.focus()}))}},{key:"GetPaoItems",value:function(){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:this.$Api.GetPAOInfoByCode,Login:!0},Data:this.InStorageForm.OrderCode,Callback:function(e){if(t.$UI.Loading.Hide(),e.IsSuccess){if(3!==e.Data.PageModel.Status&&4!==e.Data.PageModel.Status)return t.$UI.Tips.Floating("warning","请输入状态为待入库或部分入库的到货单"),void(t.InStorageForm.OrderCode="");if(t.SkuId=e.Data.PageModel.SkuId,t.SkuCode=e.Data.PageModel.SkuCode,t.StockUpWarehouseId=e.Data.PageModel.StockUpWarehouseId,t.IsGetPao=!0,t.$set(t.InStorageForm,"Id",e.Data.PageModel.Id),t.$set(t.InStorageForm,"SkuName",e.Data.PageModel.SkuName),t.$set(t.InStorageForm,"InStorageQuantity",e.Data.PageModel.WaitInStorageQuantity),t.$set(t.InStorageForm,"LocationCode",e.Data.PageModel.LocationCode),t.$set(t.InStorageForm,"InStorageQuantity2",0),t.$set(t.InStorageForm,"LocationCode2",""),t.WaitInStorageQuantity=e.Data.PageModel.WaitInStorageQuantity,0===t.InStorageForm.InStorageQuantity)return t.$UI.Tips.Floating("warning","到货单".concat(t.InStorageForm.OrderCode,"无待入库产品，无法入库")),t.$refs["InStorageForm"].resetFields(),void t.$refs.InStorageOrderCodeInput.focus();""!==e.Data.PageModel.LocationCode?t.$refs["InStorageForm"].validateField("LocationCode",(function(e){""!==e?(t.$UI.Tips.Floating("warning","到货单".concat(t.InStorageForm.OrderCode,"中的SKU货架号格式不正确，无法入库，请先对SKU进行移货后再进行入库操作")),t.ResetInStorageForm()):(t.ReadonlyLocation1=!0,t.IsOpen&&t.GetSpare(),t.$refs.InStorageQuantityInput.focus())})):(t.IsOpen&&t.GetSpare(),t.$refs.InStorageQuantityInput.focus())}else t.$Request.Error(e)}})}},{key:"GetSpare",value:function(){var t=this,e={SkuId:this.SkuId,SkuCode:this.SkuCode,WarehouseId:this.StockUpWarehouseId};this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Warehouse,Api:{Address:this.$Api.GetSkuInventory,Login:!0},Data:e,Callback:function(e){t.$UI.Loading.Hide(),1==e.IsSuccess&&""!==e.Data.Data.LocationCode&&(t.InStorageForm.LocationCode2=e.Data.Data.LocationCode,t.ReadonlyLocation2=!0)}})}},{key:"ResetInStorageForm",value:function(){this.InStorageForm=new d["a"].InStorageForm,this.$refs["InStorageForm"].resetFields(),this.IsGetPao=!1,this.IsOpen=!1,this.ReadonlyLocation1=!1,this.ReadonlyLocation2=!1,this.SkuId=0,this.StockUpWarehouseId=0,this.SkuCode="",this.WaitInStorageQuantity=0,this.$nextTick((function(){this.$refs.InStorageOrderCodeInput.focus()}))}},{key:"PostInStorage",value:function(t){var e=this;if("Num1"!==t||0!==this.InStorageForm.InStorageQuantity)if("Num1"!==t||""!==this.InStorageForm.LocationCode)if("Num1"===t&&""!==this.InStorageForm.LocationCode&&this.IsOpen&&0===this.InStorageForm.InStorageQuantity2)this.$refs.InStorageQuantity2Input.focus();else if("Num1"===t&&""!==this.InStorageForm.LocationCode&&this.IsOpen&&0!==this.InStorageForm.InStorageQuantity2&&""===this.inStorageForm.LocationCode2)this.$refs.InStorageLocationCode2Input.focus();else if("Location1"!==t||""!==this.InStorageForm.LocationCode)if("Location1"===t&&this.single&&0===this.InStorageForm.InStorageQuantity2)this.$refs.InStorageQuantity2Input.focus();else if("Location1"===t&&this.single&&""===this.InStorageForm.LocationCode2)this.$refs.InStorageLocationCode2Input.focus();else if("Num2"!==t||0!==this.InStorageForm.InStorageQuantity2)if("Num2"!==t||""!=this.InStorageForm.LocationCode2){var o;if(!this.IsGetPao)return this.$UI.Tips.Floating("warning","请输入并加载到货单号"),void this.$refs.InStorageOrderCodeInput.focus();o=JSON.parse(JSON.stringify(this.InStorageForm)),this.$refs["InStorageForm"].validate((function(t){t?Number(o.InStorageQuantity)+Number(o.InStorageQuantity2)>e.WaitInStorageQuantity?e.$UI.Tips.Floating("warning","入库数量不能大于待入库数量"):e.IsOpen&&e.InStorageForm.InStorageQuantity2>0?e.$UI.Tips.Modal({Type:"confirm",Content:"入库明细：发货仓".concat(e.InStorageForm.LocationCode,"入库").concat(e.InStorageForm.InStorageQuantity,"件；备货仓").concat(e.InStorageForm.LocationCode2,"入库").concat(e.InStorageForm.InStorageQuantity2,"件。确定数量无误？"),Enter:!1,Callback:function(t){t&&e.InStorageAjax(o)}}):(e.InStorageForm.InStorageQuantity2=0,e.InStorageForm.LocationCode2="",e.InStorageAjax(e.InStorageForm)):e.$refs["InStorageForm"].validateField("OrderCode",(function(t){""!==t?e.$refs.InStorageOrderCodeInput.focus():e.$refs["InStorageForm"].validateField("InStorageQuantity",(function(t){""!==t?e.$refs.InStorageQuantityInput.focus():e.$refs["InStorageForm"].validateField("LocationCode",(function(t){""!==t?e.$refs.InStorageLocationCodeInput.focus():e.IsOpen?e.$nextTick((function(){var t=this;this.$refs["InStorageForm"].validateField("InStorageQuantity2",(function(e){""!==e?t.$refs.InStorageQuantity2Input.focus():t.$refs["InStorageForm"].validateField("LocationCode2",(function(e){""!==e&&t.$refs.InStorageLocationCode2Input.focus()}))}))})):e.$refs.InStorageQuantityInput.focus()}))}))}))}))}else this.$refs.InStorageLocationCode2Input.focus();else this.$refs.InStorageQuantity2Input.focus();else this.$refs.InStorageLocationCodeInput.focus();else this.$refs.InStorageLocationCodeInput.focus();else this.$refs.InStorageQuantityInput.focus()}},{key:"InStorageAjax",value:function(t){var e=this;t.InStorageQuantity=Number(t.InStorageQuantity),t.InStorageQuantity2=Number(t.InStorageQuantity2),this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:this.$Api.PurchaseArrivalOrderInStorage,Login:!0},Data:t,Callback:function(t){e.$UI.Tips.Floating("success","入库成功"),1==t.IsSuccess?(e.ResetInStorageForm(),e.$refs.InStorageOrderCodeInput.focus(),e.HandleResMsg(1)):(e.$UI.Loading.Hide(),e.$refs["InStorageForm"].resetFields(),e.$refs.InStorageOrderCodeInput.focus(),e.$Request.Error(t))}})}},{key:"ClearModal",value:function(t){var e=this;this.$set(this,"ModifyModal",!1),this.ResetInStorageForm(),this.$nextTick((function(){e.HandleResMsg(t)})),this.InStorageForm=new d["a"].InStorageForm}}]),o}(c["d"]);I["a"]([Object(c["b"])()],g.prototype,"HandleResMsg",null),I["a"]([Object(c["e"])("IsOpen")],g.prototype,"IsOpenLocationCode",null),g=I["a"]([Object(c["a"])({name:"InStorage"})],g);var S=g,l=S,f=o("4023"),m=Object(f["a"])(l,a,n,!1,null,null,null);e["default"]=m.exports}}]);