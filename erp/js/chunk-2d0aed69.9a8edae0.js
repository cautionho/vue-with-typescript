(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0aed69"],{"0c88":function(e,n,t){"use strict";t.r(n);var r=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("Modal",{attrs:{title:e.Title,"mask-closable":!1,width:1200},on:{"on-cancel":function(n){return e.EmitPurchase(!1)}},model:{value:e.OpenApplyModal,callback:function(n){e.OpenApplyModal=n},expression:"OpenApplyModal"}},[t("Table",{attrs:{size:"small","highlight-row":!0,columns:e.ApplyFinanceCol,data:e.FinanceData,border:"",stripe:"",height:"500"}}),1===e.FinanceModule||3===e.FinanceModule?t("div",{staticClass:"P-TA-R P-MT-10"},[t("Button",{attrs:{type:"primary"},on:{click:e.AddRow}},[e._v("添加一行")])],1):e._e(),t("footer",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"primary"},on:{click:function(n){return e.ValidateCheckPON(!0)}}},[e._v("提交")]),e.FinanceModule?t("Button",{attrs:{type:"primary"},on:{click:function(n){return e.ValidateCheckPON(!1)}}},[e._v(e._s([2,4].includes(e.FinanceModule)?"修改":"添加"))]):e._e(),t("Button",{on:{click:function(n){return e.EmitPurchase(!1)}}},[e._v("取消")])],1)],1)},a=[],o=(t("6412"),t("9660"),t("5e8c"),t("e8f2"),t("ef8f"),t("0b78"),t("3231")),i=t("064d"),u=t("46d7"),c=t("631e"),s=t("4a81"),p=t("d11d"),d=t("c638"),l=function(e){Object(u["a"])(t,e);var n=Object(c["a"])(t);function t(){var e;return Object(o["a"])(this,t),e=n.apply(this,arguments),e.FinanceModule=0,e.SelectedData=[],e.Title="",e.PayTypeList=e.$Utils.GetEnumArr(e.$Enums.Finance.PayType),e.RefundTypeList=e.$Utils.GetEnumArr(e.$Enums.Finance.RefundType),e.FinanceData=[],e.OpenApplyModal=!1,e.ApplyFinanceCol=[{renderHeader:function(e,n){return e("div",{class:"P-Required"},"费用类型")},render:function(n,t){var r=4===e.CurrentPon?e.PayTypeList:e.RefundTypeList;return n("Select",{props:{placeholder:"请选择费用类型",value:4===e.CurrentPon?t.row.PayType:t.row.RefundType,options:r,onChange:function(n){e.SetTabInput(n,t.index,4===e.CurrentPon?"PayType":"RefundType")}}})}},{renderHeader:function(e,n){return e("div",{class:"P-Required"},"来源单据")},render:function(n,t){return n("Input",{props:{placeholder:"请输入来源单据",value:t.row.SourceCode},on:{"on-change":function(n){e.SetTabInput(n.target.value,t.index,"SourceCode")}}})}},{title:"货品金额（CNY）",key:"PurchaserName",render:function(n,t){return e.SetInput(n,t)}},{title:"运费（CNY）",key:"PurchaserName",render:function(n,t){return n("InputNumber",{props:{placeholder:"请输入运费",value:t.row.ShippingAmount,min:0},on:{"on-change":function(n){e.SetTabInput(n,t.index,"ShippingAmount")}}})}},{renderHeader:function(e,n){return e("div",{class:"P-Required"},"总金额")},render:function(e,n){return e("span","￥"+(n.row.GoodsAmount+n.row.ShippingAmount).toFixed(2))}},{renderHeader:function(e,n){return e("div",{class:"P-Required"},"经办人")},render:function(n,t){return n("Select",{props:{placeholder:"请选择经办人",value:t.row.Operator,options:e.FinanceDropList,onChange:function(n){e.SetTabInput(n,t.index,"Operator")}}})}},{title:"平台单号",key:"PurchaserName",render:function(n,t){return n("Input",{props:{placeholder:"请输入平台单号",value:t.row.PlatformOrderId},on:{"on-change":function(n){e.SetTabInput(n.target.value,t.index,"PlatformOrderId")}}})}},{title:"备注",key:"PurchaserName",render:function(n,t){return n("Input",{props:{placeholder:"请输入备注",value:t.row.Remark},on:{"on-change":function(n){e.SetTabInput(n.target.value,t.index,"Remark")}}})}}],e}return Object(i["a"])(t,[{key:"EmitPurchase",value:function(e){this.FinanceData=[],this.OpenApplyModal=!1}},{key:"TriggerModal",value:function(e,n){var t=this;if(void 0===n){if(4===this.CurrentPon&&!e.every((function(e){return 9==e.Status&&1==e.PayStatus})))return void this.$UI.Tips.Floating("warning","请选择状态为待付款且未申请付款的采购单进行操作");if(5===this.CurrentPon&&!e.every((function(e){return(4==e.Status||5==e.Status||6==e.Status||7==e.Status||9==e.Status)&&1==e.RefundStatus})))return void this.$UI.Tips.Floating("warning","请选择状态为待付款、待发货、待签收、待入库或部分入库且未申请退款的采购单进行操作")}this.$nextTick((function(){t.SelectedData=e,t.FinanceModule=n,t.Title=1==t.FinanceModule?"添加付款单":2==t.FinanceModule?"编辑付款单":3==t.FinanceModule?"添加退款单":4==t.FinanceModule?"编辑退款单":4==t.CurrentPon?"申请付款":5==t.CurrentPon?"申请退款":"",t.TestingCol(),t.ParseData(),t.OpenApplyModal=!0}))}},{key:"TestingCol",value:function(){var e=this;8!==this.ApplyFinanceCol.length||1!==this.FinanceModule&&3!==this.FinanceModule?this.ApplyFinanceCol.length>8&&this.ApplyFinanceCol.pop():this.ApplyFinanceCol.push({title:"操作",width:100,render:function(n,t){return n("Button",{props:{type:"error",size:"small"},on:{click:function(){e.DeleteRow()}}},"删除")}})}},{key:"SetTabInput",value:function(e,n,t){this.FinanceData[n][t]=e,"GoodsAmount"!==t&&"ShippingAmount"!==t||(4===this.CurrentPon?this.FinanceData[n]["PayAmount"]=Number((this.FinanceData[n]["GoodsAmount"]+this.FinanceData[n]["ShippingAmount"]).toFixed(2)):this.FinanceData[n]["RefundAmount"]=Number((this.FinanceData[n]["GoodsAmount"]+this.FinanceData[n]["ShippingAmount"]).toFixed(2))),"Operator"===t&&(this.FinanceData[n]["OperatorName"]="")}},{key:"ParseData",value:function(){var e=this;this.SelectedData.forEach((function(n){var t=new d["a"].ApplyFinanceData;t["ShippingAmount"]=e.FinanceModule?n.ShippingAmount:n.ShippingCost,t["SourceCode"]=e.FinanceModule?n.SourceCode:n.PurchaseCode,t["GoodsAmount"]=e.FinanceModule?n.GoodsAmount:n.TotalPrice,t["OperatorName"]="",t["CreateTime"]=e.$UI.Render.NewDate(new Date),t["Creator"]=JSON.parse(e.$Cookie.Get("frler_user")).UserId,t["CreatorName"]=JSON.parse(e.$Cookie.Get("frler_user")).UserName,t["OperateTime"]=e.$UI.Render.NewDate(new Date),t["GoodsCurrency"]="CNY",t["ShippingCurrency"]="CNY",t["Operator"]=308,4===e.CurrentPon?(e.FinanceModule?(t["Id"]=n.Id,t["PayAmount"]=Number(n.PayAmount),t["PayType"]=n.PayType,t["Remark"]=n.Remark,t["PlatformOrderId"]=n.PlatformOrderId,t["PayCode"]=n.PayCode,t["Operator"]=n.Operator?n.Operator:308,t["OperatorName"]=n.OperatorName?n.OperatorName:"",t["Status"]=1):(t["PayAmount"]=Number(n.TotalPrice)+Number(n.ShippingCost),t["PayType"]=1,t["PayCode"]=""),t["PayCurrency"]="CNY"):(e.FinanceModule?(t["Id"]=n.Id,t["RefundAmount"]=Number(n.RefundAmount),t["RefundType"]=n.RefundType,t["Remark"]=n.Remark,t["PlatformOrderId"]=n.PlatformOrderId,t["RefundCode"]=n.PayCode,t["Operator"]=n.Operator?n.Operator:308,t["OperatorName"]=n.OperatorName?n.OperatorName:"",t["Status"]=1):(t["RefundAmount"]=Number(n.TotalPrice)+Number(n.ShippingCost),t["RefundType"]=1,t["RefundCode"]=""),t["RefundCurrency"]="CNY"),e.FinanceData.push(t)}))}},{key:"AddRow",value:function(){var e=new d["a"].ApplyFinanceData;e["CreateTime"]=this.$UI.Render.NewDate(new Date),e["Creator"]=JSON.parse(this.$Cookie.Get("frler_user")).UserId,e["CreatorName"]=JSON.parse(this.$Cookie.Get("frler_user")).UserName,e["OperateTime"]=this.$UI.Render.NewDate(new Date),e["Operator"]=308,e["GoodsCurrency"]="CNY",e["ShippingCurrency"]="CNY",4===this.CurrentPon?(e["PayCurrency"]="CNY",e["PayType"]=0,e["PayCode"]="",e["PayAmount"]=0):(e["RefundCurrency"]="CNY",e["RefundType"]=0,e["RefundCode"]="",e["RefundAmount"]=0),this.FinanceData.push(e)}},{key:"ValidateCheckPON",value:function(e){var n=this;if(this.FinanceData.length<1)this.$UI.Tips.Floating("warning","请添加数据");else{var t=!0;try{this.FinanceData.forEach((function(e,r){if(4===n.CurrentPon&&0===e.PayType||5===n.CurrentPon&&0===e.RefundType)throw n.$UI.Tips.Floating("warning","请选择第[".concat(r+1,"]项的费用类型")),t=!1,new Error("break");if(!e.SourceCode)throw n.$UI.Tips.Floating("warning","请输入第[".concat(r+1,"]项的来源单据")),t=!1,new Error("break");if(4===n.CurrentPon&&0===e.PayAmount||5===n.CurrentPon&&0===e.RefundAmount)throw n.$UI.Tips.Floating("warning","请输入第[".concat(r+1,"]项的总金额")),t=!1,new Error("break");if(0===e.Operator)throw n.$UI.Tips.Floating("warning","请选择第[".concat(r+1,"]项的经办人")),t=!1,new Error("break")}))}catch(r){if("break"!==r.message)throw r}t&&this.CheckPON(e)}}},{key:"CheckPON",value:function(e){var n=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Finance,Api:{Address:2===this.FinanceModule?this.$Api.PayOrderModify:4===this.FinanceModule?this.$Api.RefundOrderModify:4===this.CurrentPon?this.$Api.PayOrderCreate:this.$Api.RefundOrderCreate,Login:!0},Data:{Data:[2,4].includes(this.FinanceModule)?this.FinanceData[0]:this.FinanceData,IsSubmit:e},Callback:function(e){e.IsSuccess?(n.$UI.Tips.Floating("success","".concat(1==n.FinanceModule?"添加付款单":2==n.FinanceModule?"编辑付款单":3==n.FinanceModule?"添加退款单":4==n.FinanceModule?"编辑退款单":4===n.CurrentPon?"申请付款":5===n.CurrentPon?"申请退款":"","成功")),n.EmitPurchase(!0)):(n.$Request.Error(e),n.$UI.Loading.Hide())}})}},{key:"SetInput",value:function(e,n){var t=this;return this.FinanceModule?e("InputNumber",{props:{placeholder:"请输入货品金额",value:n.row.GoodsAmount,min:0},on:{"on-change":function(e){t.SetTabInput(e,n.index,"GoodsAmount")}}}):e("span",n.row.GoodsAmount)}},{key:"FinanceDropList",get:function(){return this.DropFinanceList}}]),t}(p["d"]);s["a"]([Object(p["c"])()],l.prototype,"DropFinanceList",void 0),s["a"]([Object(p["c"])()],l.prototype,"CurrentPon",void 0),s["a"]([Object(p["b"])()],l.prototype,"EmitPurchase",null),l=s["a"]([Object(p["a"])({name:"ApplyFinanceOrder"})],l);var h=l,f=h,y=t("4023"),m=Object(y["a"])(f,r,a,!1,null,null,null);n["default"]=m.exports}}]);