(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cbe97"],{"4c4f":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Row",{staticClass:"P-Inline-Block"},[e.Power?r("Button",{staticClass:"P-Inline-Block P-MR-10",attrs:{type:"primary"},on:{click:function(t){return e.TriggerModal(null)}}},[e._v("添加规则")]):e._e(),r("Modal",{attrs:{title:0===e.RuleForm.Id?"添加规则":"修改规则","mask-closable":!1,width:680},on:{"on-cancel":function(t){return e.ChangeModifyRule(!1)}},model:{value:e.IsShow,callback:function(t){e.IsShow=t},expression:"IsShow"}},[r("Form",{ref:"RuleForm",attrs:{onsubmit:"return false",model:e.RuleForm,rules:e.Rule,"label-width":100,name:"RuleForm"}},[r("Form-item",{attrs:{label:"规则名称：",prop:"RuleName"}},[r("Input",{attrs:{placeholder:"请输入规则名称"},model:{value:e.RuleForm.RuleName,callback:function(t){e.$set(e.RuleForm,"RuleName",t)},expression:"RuleForm.RuleName"}})],1),r("Form-item",{attrs:{label:"平台：",prop:"PlatformId"}},[r("Select",{attrs:{placeholder:"请选择平台",onChange:e.OnClearSelect.bind(this,"PlatformId"),options:e.PlatformList},model:{value:e.RuleForm.PlatformId,callback:function(t){e.$set(e.RuleForm,"PlatformId",t)},expression:"RuleForm.PlatformId"}})],1),r("Form-item",{attrs:{label:"店铺：",prop:"StoreId"}},[r("Select",{ref:"Store",attrs:{placeholder:"请选择店铺",onChange:e.OnClearSelect.bind(this,"StoreId"),options:e.DropStoreList},model:{value:e.RuleForm.StoreId,callback:function(t){e.$set(e.RuleForm,"StoreId",t)},expression:"RuleForm.StoreId"}})],1),r("Form-item",{attrs:{label:"国家：",prop:"Country"}},[r("Select",{attrs:{placeholder:"请选择国家",onChange:e.OnClearSelect.bind(this,"Country"),options:e.CountryData,optionValKey:"CountryCode",optionKey:"CountryNameCn"},model:{value:e.RuleForm.Country,callback:function(t){e.$set(e.RuleForm,"Country",t)},expression:"RuleForm.Country"}})],1),r("Form-item",{attrs:{label:"发货仓：",prop:"WarehouseId"}},[r("Select",{attrs:{placeholder:"请选择发货仓",disabled:!0,options:e.WarehouseList},model:{value:e.RuleForm.WarehouseId,callback:function(t){e.$set(e.RuleForm,"WarehouseId",t)},expression:"RuleForm.WarehouseId"}})],1),r("Form-item",{attrs:{label:"物流渠道：",prop:"ShippingMethodId"}},[r("Select",{ref:"shipMethod",attrs:{placeholder:"请选择物流渠道",multiple:"",options:e.ShipMethodList,optionValKey:"Id",optionKey:"Name"},model:{value:e.RuleForm.ShippingMethodId,callback:function(t){e.$set(e.RuleForm,"ShippingMethodId",t)},expression:"RuleForm.ShippingMethodId"}})],1),r("Form-item",{attrs:{label:"订单类型：",prop:"ItemType"}},[r("Select",{attrs:{placeholder:"请选择订单类型",options:e.ItemTypeList},model:{value:e.RuleForm.ItemType,callback:function(t){e.$set(e.RuleForm,"ItemType",t)},expression:"RuleForm.ItemType"}})],1),r("Form-item",{attrs:{label:"库区：",prop:"Area"}},[r("Select",{attrs:{multiple:"",placeholder:"请选择库区（可多选）",options:e.LocationList},model:{value:e.RuleForm.Area,callback:function(t){e.$set(e.RuleForm,"Area",t)},expression:"RuleForm.Area"}})],1),r("Form-Item",{attrs:{label:"时间段："}},[r("Select",{staticClass:"P-W-200",attrs:{placeholder:"请选择时间类型",onChange:e.OnClearSelect.bind(this,"TimeType"),options:e.TimeTypeList},model:{value:e.RuleForm.TimeType,callback:function(t){e.$set(e.RuleForm,"TimeType",t)},expression:"RuleForm.TimeType"}}),r("FormItem",{staticClass:"P-Inline-Block",staticStyle:{width:"160px"},attrs:{prop:"StartTime"}},[r("Date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间",placement:"top",transfer:""},on:{"on-change":e.PickStartTime},model:{value:e.RuleForm.StartTime,callback:function(t){e.$set(e.RuleForm,"StartTime",t)},expression:"RuleForm.StartTime"}})],1),e._v(" - "),r("FormItem",{staticClass:"P-Inline-Block",staticStyle:{width:"160px"},attrs:{prop:"EndTime"}},[r("Date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间",placement:"top",transfer:""},on:{"on-change":e.PickEndTime},model:{value:e.RuleForm.EndTime,callback:function(t){e.$set(e.RuleForm,"EndTime",t)},expression:"RuleForm.EndTime"}})],1)],1),r("Form-item",{attrs:{label:"生成规则：",prop:"Quantity"}},[e._v(" 每 "),r("Input",{staticStyle:{width:"40%"},attrs:{placeholder:"请输入订单个数"},model:{value:e.RuleForm.Quantity,callback:function(t){e.$set(e.RuleForm,"Quantity",t)},expression:"RuleForm.Quantity"}}),e._v(" 个订单自动生成一个批次 ")],1)],1),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:e.CheckData}},[e._v(e._s(0===e.RuleForm.Id?"添加":"修改"))]),r("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){return e.ChangeModifyRule(!1)}}},[e._v("取消")])],1)],1)],1)},i=[],a=(r("0a9c"),r("76bb"),r("b916"),r("d088"),r("3231")),l=r("064d"),s=r("46d7"),n=r("631e"),u=r("4a81"),m=r("d11d"),p=r("1f41"),d=function(e){Object(s["a"])(r,e);var t=Object(n["a"])(r);function r(){var e;return Object(a["a"])(this,r),e=t.apply(this,arguments),e.IsShow=!1,e.WarehouseList=[],e.CountryData=[],e.RuleForm=new p["a"].ModifyRuleDetail,e.ItemTypeList=e.$Utils.GetEnumArr(e.$Enums.Warehouse.ItemType),e.LocationList=e.GetLocations(),e.PlatformList=e.$Utils.GetEnumArr(e.$Enums.Sales.Platform),e.ShipMethodList=[],e.DropStoreList=[],e.TimeTypeList=e.$Utils.GetEnumArr(e.$Enums.Warehouse.TimeType),e.Rule={WarehouseId:[{required:!0,message:"请选择发货仓",trigger:"change",type:"number"}],ShippingMethodId:[{required:!0,message:"请选择物流渠道",trigger:"change",type:"array"}],ItemType:[{required:!0,pattern:e.$Pattern.PositiveNotZero,message:"请选择订单类型",trigger:"change",type:"number"}],RuleName:[{required:!0,message:"请输入规则名称",type:"string"}],Quantity:[{required:!0,pattern:/^[1-9]+[0-9]*]*$/,message:"生成规则格式不正确"}]},e}return Object(l["a"])(r,[{key:"ChangeModifyRule",value:function(e){this.IsShow=!1,this.$refs.RuleForm.resetFields()}},{key:"ChangePlatForm",value:function(e){this.RuleForm.StoreId="",0!=this.DropStoreList.length&&this.$refs.Store.clearSingleSelect(),this.DropStoreList=[],""!=e&&this.GetStoreDropList(e)}},{key:"GetLocations",value:function(){for(var e=[],t=1;t<=15;t++)e.push({Key:t,Value:t});return e}},{key:"TriggerModal",value:function(e){var t=this;this.ShipMethodList.length<1&&this.GetShipMethodDrop(),this.WarehouseList.length<1&&this.GetWarehouseDropList(),this.CountryData.length<1&&this.GetCountryDropList(),null===e?(this.RuleForm=new p["a"].ModifyRuleDetail,this.$set(this.RuleForm,"WarehouseId",50)):(this.$set(this.RuleForm,"PlatformId",0==e.PlatformId?"":e.PlatformId),setTimeout((function(){t.RuleForm.Country=e["Country"],t.RuleForm.EndTime=e["EndTime"],t.RuleForm.Id=e["Id"],t.RuleForm.ItemType=e["ItemType"],t.RuleForm.Quantity=e["Quantity"],t.RuleForm.RuleName=e["RuleName"],t.RuleForm.StartTime=e["StartTime"],t.RuleForm.StoreId=e["StoreId"],t.RuleForm.WarehouseId=e["WarehouseId"],t.RuleForm.TimeType=0==e["TimeType"]?"":e["TimeType"],t.RuleForm.Area=e["Area"].split(",").map((function(e){return parseInt(e)})),t.RuleForm.ShippingMethodId=e["ShippingMethodId"].split(",").map((function(e){return parseInt(e)})),"1900-01-01T00:00:00"==t.RuleForm.StartTime&&(t.RuleForm.StartTime="",t.RuleForm.EndTime="")}),100)),this.IsShow=!0}},{key:"OnClearSelect",value:function(e){void 0==this.RuleForm[e]&&this.$set(this.RuleForm,e,"")}},{key:"PickStartTime",value:function(e){this.RuleForm.StartTime=e}},{key:"PickEndTime",value:function(e){this.RuleForm.EndTime=e}},{key:"GetStoreDropList",value:function(e){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Sales,Api:{Address:this.$Api.Sales[e].StoreDrop},Data:"",Callback:function(e){t.$UI.Loading.Hide(),e.IsSuccess?t.DropStoreList=e.Data.DropList:t.$Request.Error(e)}})}},{key:"GetShipMethodDrop",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Logistics,Api:{Address:this.$Api.ChannelDropList},Data:50,Callback:function(t){e.$UI.Loading.Hide(),t.IsSuccess?e.ShipMethodList=t.Data.DropList:e.$Request.Error(t)}})}},{key:"GetWarehouseDropList",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Settings,Api:{Address:this.$Api.GetWarehouseDropList},Data:"",Callback:function(t){e.$UI.Loading.Hide(),t.IsSuccess?e.WarehouseList=t.Data.DropList:e.$Request.Error(t)}})}},{key:"GetCountryDropList",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Settings,Api:{Address:this.$Api.CountryList},Data:!0,Callback:function(t){e.$UI.Loading.Hide(),t.IsSuccess?e.CountryData=t.Data.DropList:e.$Request.Error(t)}})}},{key:"CheckData",value:function(){var e=this;this.$refs["RuleForm"].validate((function(t){if(t){if(""!==e.RuleForm.TimeType){if(""==e.RuleForm.StartTime&&""==e.RuleForm.EndTime)return void e.$UI.Tips.Floating("warning","请选择开始时间和结束时间");if(""==e.RuleForm.StartTime)return void e.$UI.Tips.Floating("warning","请选择开始时间");if(""==e.RuleForm.EndTime)return void e.$UI.Tips.Floating("warning","请选择结束时间")}else if(""!==e.RuleForm.StartTime||""!==e.RuleForm.EndTime)return void e.$UI.Tips.Floating("warning","请选择时间类型");var r=Date.parse(e.RuleForm.StartTime),o=Date.parse(e.RuleForm.EndTime);if(r>o)return void e.$UI.Tips.Floating("warning","开始时间不能晚于结束时间");e.PostRule()}}))}},{key:"PostRule",value:function(){var e=this;this.$UI.Loading.Show();var t=JSON.parse(JSON.stringify(this.RuleForm));t.ShippingMethodId=t.ShippingMethodId.join(","),t.Area=t.Area.join(","),t.StartTime=""==t.StartTime?"":this.$UI.Render.NewDate(t.StartTime,!1),t.EndTime=""==t.EndTime?"":this.$UI.Render.NewDate(t.EndTime,!1),this.$Request.Post({Server:this.$Server.Warehouse,Api:{Address:0!==this.RuleForm.Id?this.$Api.BatchOrderRuleModify:this.$Api.BatchOrderRuleAdd,Login:!0},Data:t,Callback:function(t){t.IsSuccess?(e.$UI.Tips.Floating("success",0!==e.RuleForm.Id?"编辑规则成功":"添加规则成功"),e.ChangeModifyRule(!0)):(e.$Request.Error(t),e.$UI.Loading.Hide())}})}}]),r}(m["d"]);u["a"]([Object(m["c"])()],d.prototype,"Power",void 0),u["a"]([Object(m["b"])()],d.prototype,"ChangeModifyRule",null),u["a"]([Object(m["e"])("RuleForm.PlatformId")],d.prototype,"ChangePlatForm",null),d=u["a"]([Object(m["a"])({name:"ModifyPickBatchRule"})],d);var c=d,h=c,R=r("4023"),S=Object(R["a"])(h,o,i,!1,null,null,null);t["default"]=S.exports}}]);