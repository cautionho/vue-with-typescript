(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7eede678"],{2266:function(e,t,a){"use strict";var r=a("7b30"),n=a("ce83").findIndex,i=a("2e3e"),o="findIndex",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),r({target:"Array",proto:!0,forced:s},{findIndex:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i(o)},"279a":function(e,t,a){"use strict";var r=a("437d"),n=a.n(r);n.a},"437d":function(e,t,a){},"6d45":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"P-Inline-Block "},[a("Col",[a("Button",{staticClass:"P-MR-10 P-MB-10",attrs:{type:"primary"},on:{click:e.OpenModifyAuthorizationModal}},[e._v("批量增加授权")]),a("Modal",{attrs:{title:e.IsBatch?"批量增加授权":"修改店铺授权","mask-closable":!1,width:800},on:{"on-cancel":function(t){return e.ClearModal(0)}},model:{value:e.ModifyAuthorizationModal,callback:function(t){e.ModifyAuthorizationModal=t},expression:"ModifyAuthorizationModal"}},[a("Row",{staticClass:"Row-Tree"},[a("Tree",{ref:"TargetTree",staticClass:"P-ML-20",attrs:{data:e.Tree,"show-checkbox":""}})],1),a("Row",[a("Col",{staticClass:"Row-Item",attrs:{span:"3"}},[e._v("已选店铺： ")]),e.Tree.length>0?a("Col",{staticClass:"Row-Authorization",attrs:{span:"21"}},e._l(e.SelectedShopName,(function(t,r){return a("span",{key:r},[a("strong",[e._v(e._s(t.Platform)+":")]),e._l(t.Store,(function(r,n){return a("span",{key:n},[e._v(" "+e._s(r)+" "),n<t.Store.length-1?a("span",[e._v(",")]):e._e()])})),r<=t.length-1?a("span",[e._v("；")]):e._e()],2)})),0):e._e()],1),a("Row",[a("Col",{staticClass:"Row-Item-UserName",attrs:{span:"3"}},[e._v("用户姓名： ")]),a("Col",{staticClass:"Row-Authorization",attrs:{span:"21"}},e._l(e.SelectedUserName,(function(t,r){return a("Tag",{key:r,attrs:{type:"border",name:r,closable:"",color:"primary"},on:{"on-close":e.HandleDeleteUserName}},[e._v(e._s(t.UserName))])})),1)],1),a("Row",{staticClass:"P-MT-10"}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:e.SubModal}},[e._v("提交")]),a("Button",{on:{click:function(t){return e.ClearModal(0)}}},[e._v("取消")])],1)],1)],1)],1)},n=[],i=(a("d9b9"),a("02cc"),a("2266"),a("9660"),a("5f3d"),a("5e8c"),a("76bb"),a("6ed5"),a("cee1"),a("e8f2"),a("6bf8"),a("b916"),a("eb83"),a("7623"),a("9b6f"),a("522a"),a("d088"),a("0b78"),a("52af"),a("5c62")),o=a("e24e"),s=a("3231"),l=a("064d"),c=a("46d7"),u=a("631e"),d=a("4a81"),h=a("d11d"),f=function(e){Object(c["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;return Object(s["a"])(this,a),e=t.apply(this,arguments),e.OriginalTreeData=[],e.Tree=[],e.TargetTree=[],e.SelecData=[],e.IsBatch=!1,e.ShopTypeList={},e.ModifyAuthorizationModal=!1,e}return Object(l["a"])(a,[{key:"HandleResMsg",value:function(e){}},{key:"Trigger",value:function(e){this.IsBatch&&0===e.length?this.$UI.Tips.Floating("warning","请选择用户进行操作"):(this.SelecData=JSON.parse(JSON.stringify(e)),this.GetTree(),this.$nextTick((function(){this.$set(this,"ModifyAuthorizationModal",!0)})))}},{key:"GetTree",value:function(){var e=this;this.$UI.Loading.Show(),this.$set(this,"Tree",[]),this.$Request.Post({Server:this.$Server.Admin,Api:{Address:this.$Api.AuthorizationStorePermissionTree,Login:!0},Data:{UserId:this.IsBatch?0:this.SelecData[0].Id,IsBatch:this.IsBatch},Callback:function(t){t.IsSuccess?(e.$set(e,"OriginalTreeData",t.Data.Data.filter((function(e){return!0===e.IsOwn}))),e.IntegratedData(t.Data.Data)):e.$Request.Error(t),e.$UI.Loading.Hide()}})}},{key:"IntegratedData",value:function(e){var t=this;e.forEach((function(e){if(t.Tree.some((function(t){return t.Value===e.PlatformId}))){var a=t.Tree.findIndex((function(t){return t.Value===e.PlatformId})),r={Value:e.StoreId,Key:e.StoreName,parent:e.PlatformId,title:e.StoreName,value:e.PlatformId+"-"+e.StoreId,checked:e.IsOwn,children:[]};t.Tree[a].children.push(r)}else{var n={Value:e.PlatformId,Key:e.PlatformName,parent:0,title:e.PlatformName,value:e.PlatformName+"-"+e.PlatformId,children:[{Value:e.StoreId,Key:e.StoreName,parent:e.PlatformId,title:e.StoreName,value:e.PlatformId+"-"+e.StoreId,children:[],checked:e.IsOwn}]};t.Tree.push(n)}}));var a,r=Object(o["a"])(this.Tree);try{for(r.s();!(a=r.n()).done;){var n=a.value;this.ShopTypeList[n.Value]=n.Key}}catch(i){r.e(i)}finally{r.f()}}},{key:"OpenModifyAuthorizationModal",value:function(){this.IsBatch=!0,this.HandleResMsg(2)}},{key:"ClearModal",value:function(e){this.IsBatch=!1,this.$set(this,"ModifyAuthorizationModal",!1),this.HandleResMsg(e)}},{key:"HandleDeleteUserName",value:function(e,t){1!==this.SelecData.length?this.SelecData.splice(t,1):this.$UI.Tips.Floating("warning","新增授权至少需要选中一个用户")}},{key:"SubModal",value:function(){var e=this,t=[],a=this.$refs["TargetTree"].getCheckedAndIndeterminateNodes().filter((function(e){return 0!==e.parent}));if(0!==a.length){if(this.IsBatch){var r,n=Object(o["a"])(a);try{for(n.s();!(r=n.n()).done;){var s=r.value;t.push({PlatformId:s.parent,StoreId:s.Value,IsChange:!1})}}catch(S){n.e(S)}finally{n.f()}}else{for(var l=this.OriginalTreeData.map((function(e){return e.PlatformId.toString()+"-"+e.StoreId.toString()})),c=a.map((function(e){return e.value})),u=Array.from(new Set([].concat(Object(i["a"])(c),Object(i["a"])(l)))),d=0,h=u;d<h.length;d++){var f=h[d];if(!c.includes(f)){var p=f.split("-");t.push({PlatformId:Number(p[0]),StoreId:Number(p[1]),IsChange:!0})}}for(var m=0,I=u;m<I.length;m++){var v=I[m],g=v.split("-");t.push({PlatformId:Number(g[0]),StoreId:Number(g[1]),IsChange:!1})}}this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Admin,Api:{Address:this.$Api.AuthorizationSaveStorePermission,Login:!0},Data:{UserId:this.SelecData.map((function(e){return e.Id})),Details:t},Callback:function(t){t.IsSuccess?(e.$UI.Tips.Floating("success",e.IsBatch?"批量新增授权成功":"编辑授权成功"),e.ClearModal(1)):e.$Request.Error(t)}})}else this.$UI.Tips.Floating("warning","请选择店铺")}},{key:"SelectedShopName",get:function(){var e=this,t=[],a=this.$refs["TargetTree"].getCheckedAndIndeterminateNodes().filter((function(e){return 0!==e.parent})),r=function(r){var n=e.ShopTypeList[r],i=a.filter((function(e){return e.parent===Number(r)})).map((function(e){return e.Key}));i.length>0&&t.push({Platform:n,Store:i})};for(var n in this.ShopTypeList)r(n);return t}},{key:"SelectedUserName",get:function(){var e=this.SelecData.map((function(e){return{UserName:e.UserName,UserId:e.Id}}));return e}}]),a}(h["d"]);d["a"]([Object(h["b"])()],f.prototype,"HandleResMsg",null),f=d["a"]([Object(h["a"])({name:"ModifyAuthorization"})],f);var p=f,m=p,I=(a("279a"),a("4023")),v=Object(I["a"])(m,r,n,!1,null,null,null);t["default"]=v.exports}}]);