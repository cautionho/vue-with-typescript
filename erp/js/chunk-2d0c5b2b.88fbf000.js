(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c5b2b"],{"3fce":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Row",{staticClass:"P-Inline-Block"},[e.IsBtn?a("Button",{attrs:{type:"primary"},on:{click:e.Trigger}},[e._v("发送站内信")]):e._e(),a("Modal",{attrs:{title:"发送站内信",width:800},on:{"on-cancel":e.CancelModal},model:{value:e.StationMailModal,callback:function(t){e.StationMailModal=t},expression:"StationMailModal"}},[a("Form",{ref:"SendMailForm",attrs:{model:e.SendMailForm,"label-width":0,onsubmit:"return false"}},[a("FormItem",[a("Cascader",{ref:"TplCascader",attrs:{trigger:"hover",placeholder:"请选择模板",data:e.Tree,clearable:"",filterable:""},on:{"on-change":e.RenderContent}})],1),a("FormItem",{attrs:{prop:"Content",rules:{required:!0,message:"请输入内容"}}},[a("Input",{ref:"Ipt",attrs:{placeholder:"请输入内容",type:"textarea",autosize:{maxRows:6,minRows:6}},model:{value:e.SendMailForm.Content,callback:function(t){e.$set(e.SendMailForm,"Content",t)},expression:"SendMailForm.Content"}})],1),e._l(e.SendMailForm.Images,(function(t,n){return a("div",{key:n,staticClass:"P-Inline-Block P-Uploader-Img"},[a("img",{staticClass:"P-Uploader-Img",attrs:{src:e.$Server.File+"/"+t}}),a("Icon",{staticClass:"P-Uploader-Del",attrs:{type:"md-close-circle",size:"20"},on:{click:function(t){return e.UploaderDel(n)}}})],1)})),a("Upload",{directives:[{name:"show",rawName:"v-show",value:e.SendMailForm.Images.length<5,expression:"SendMailForm.Images.length < 5"}],staticClass:"P-Uploader P-Inline-Block P-VA-T",attrs:{headers:e.$Request.Headers({Server:"",Api:{Address:"",Login:!0},Data:"",Form:!0}),"show-upload-list":!1,"on-success":e.HandleUploadSuccess,accept:".jpg, .jpge, .png",format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.HandleFormatError,"on-exceeded-size":e.HandleMaxSize,"before-upload":e.HandleBeforeUpload,multiple:"",action:""+e.$Server.Settings+e.$Api.UploadImage}},[a("div",{staticClass:"P-Uploader-Img"},[a("Icon",{attrs:{type:"md-add",size:"20"}})],1)])],2),a("footer",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:e.Validate}},[e._v("提交")]),a("Button",{on:{click:e.CancelModal}},[e._v("取消")])],1)],1)],1)},i=[],r=(a("d9b9"),a("5f3d"),a("0a9c"),a("76bb"),a("6ed5"),a("cee1"),a("1ff3"),a("6bf8"),a("7623"),a("522a"),a("52af"),a("e24e")),s=(a("b449"),a("5d83")),o=a("5c62"),l=a("3231"),d=a("064d"),c=a("46d7"),u=a("631e"),p=a("4a81"),h=a("d11d"),m=a("4606"),g=function(e){Object(c["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;return Object(l["a"])(this,a),e=t.apply(this,arguments),e.SendType=1,e.StationMailModal=!1,e.Tree=[],e.UploadQty=0,e.SendMailForm=new m["a"].SendMail,e.OrderCodes=[],e.SendErrorCodes=[],e}return Object(d["a"])(a,[{key:"EmitOperateSuccess",value:function(){}},{key:"TriggerOperations",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]}},{key:"Trigger",value:function(){this.TriggerOperations("EbayMsgSend")}},{key:"TriggerWrite",value:function(e){e.length&&!e.some((function(e){return 1!==e.ShipOrder.Platform}))?(this.OrderCodes=e.map((function(e){return e.ShipOrder.OrderCode})),this.TriggerModal()):this.$UI.Tips.Floating("warning","请选择eBay平台发货订单进行操作")}},{key:"TriggerLogisticsWrite",value:function(e){e.some((function(e){return 1!==e.Platform}))?this.$UI.Tips.Floating("warning","请选择eBay平台发货订单进行操作"):(this.$set(this,"SendType",2),this.$set(this.SendMailForm,"ShipOrderCodes",e.map((function(e){return e.OrderCode}))),this.TriggerModal())}},{key:"TriggerOrdinaryWrite",value:function(e){this.OrderCodes=e,this.TriggerModal()}},{key:"DisputedWrite",value:function(e){var t;e.length?((t=this.OrderCodes).push.apply(t,Object(o["a"])(e)),this.TriggerModal()):this.$UI.Tips.Floating("warning","请选择有关联发货订单的纠纷进行操作")}},{key:"ItemIdWrite",value:function(e,t){this.$set(this,"SendType",3),this.OrderCodes.push(e),this.$set(this.SendMailForm,"ItemId",t),this.TriggerModal()}},{key:"TriggerModal",value:function(){var e=this;this.Tree.length||this.GetTplTree(),this.$set(this,"StationMailModal",!0),this.$nextTick((function(){e.$refs.Ipt.focus()}))}},{key:"EvaluateWrite",value:function(){this.$set(this,"SendType",4)}},{key:"GetTplTree",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.GetTemplateList,Login:!0},Data:{PageIndex:1,PageSize:100000001,Conditions:new m["a"].SeatchMailTpl},Callback:function(t){if(e.$UI.Loading.Hide(),t.IsSuccess){var a=Array.from(new Set(t.Data.PageModel.Items.map((function(e){return JSON.stringify({label:e.TemplateTypeName,value:e.TemplateTypeId,children:[]})}))));e.Tree=a.map((function(e){var a=JSON.parse(e);return t.Data.PageModel.Items.map((function(e){e.TemplateTypeId===a.value&&a.children.push({label:e.TemplateTitle,value:e.TemplateId,content:e.Content})})),a}))}else e.$Request.Error(t)}})}},{key:"RenderContent",value:function(e,t){e.length&&this.$set(this.SendMailForm,"Content",t.pop().content)}},{key:"HandleUploadSuccess",value:function(e,t,a){e.IsSuccess?this.SendMailForm.Images.push(e.Data.Url):this.$Request.Error(e),this.CountUploadQty()}},{key:"HandleFormatError",value:function(e){this.$UI.Tips.Floating("warning","文件[".concat(e.name,"]格式不为JPG/JPGE/PNG，请检查")),this.CountUploadQty()}},{key:"HandleMaxSize",value:function(e,t){this.$UI.Tips.Floating("warning","文件".concat(e.name,"大小超过2M，请检查")),this.CountUploadQty()}},{key:"HandleBeforeUpload",value:function(e){if(0===this.UploadQty&&this.$UI.Loading.Show(),this.UploadQty+this.SendMailForm.Images.length>=5)return!1;this.UploadQty++}},{key:"CountUploadQty",value:function(){this.UploadQty--,this.UploadQty<=0&&this.$UI.Loading.Hide()}},{key:"UploaderDel",value:function(e){this.SendMailForm.Images.splice(e,1)}},{key:"Validate",value:function(){var e=this;this.$refs.SendMailForm.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(a){var n,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=26;break}if(2!==e.SendType){t.next=5;break}e.PostLogisticsExceptionMail(),t.next=26;break;case 5:e.$UI.Loading.Show(),n=Object(r["a"])(e.OrderCodes),t.prev=7,n.s();case 9:if((i=n.n()).done){t.next=16;break}return s=i.value,e.$set(e.SendMailForm,"ShipOrderCode",s),t.next=14,e.PostMail();case 14:t.next=9;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](7),n.e(t.t0);case 21:return t.prev=21,n.f(),t.finish(21);case 24:3===e.SendType?e.HandleItemIdRes():e.HandleNormalRes(),e.$UI.Loading.Hide();case 26:case"end":return t.stop()}}),t,null,[[7,18,21,24]])})));return function(e){return t.apply(this,arguments)}}())}},{key:"HandleItemIdRes",value:function(){this.SendErrorCodes.length?(this.$UI.Tips.Floating("success","发送失败"),this.$set(this,"SendErrorCodes",[])):(this.$UI.Tips.Floating("success","发送成功"),this.EmitOperateSuccess(),this.CancelModal())}},{key:"HandleNormalRes",value:function(){var e=this;this.$UI.Tips.Modal({Type:"success",Content:this.SendErrorCodes.length?"发送成功，其中".concat(this.SendErrorCodes.length,"个订单的站内信发送失败。失败订单如下：").concat(this.SendErrorCodes.join(",")):"发送成功",Callback:function(t){e.CancelModal(),e.EmitOperateSuccess(),e.$set(e,"SendErrorCodes",[])}})}},{key:"PostLogisticsExceptionMail",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.BatchSendEmail,Login:!0},Data:this.SendMailForm,Callback:function(t){e.$UI.Loading.Hide(),t.IsSuccess?e.$UI.Tips.Modal({Type:t.Data.IsAllSuccess?"success":"error",Content:"".concat(t.Data.ResultContent,"。").concat(t.Data.IsAllSuccess?"":'<a href="'+e.$Server.CustomerService+t.Data.Url+'" download>下载邮件发送失败订单表格</a>'),Callback:function(a){t.Data.IsAllSuccess&&(e.CancelModal(),e.EmitOperateSuccess())}}):e.$Request.Error(t)}})}},{key:"PostMail",value:function(){var e=this;return new Promise((function(t){e.$Request.Post({Server:e.$Server.CustomerService,Api:{Address:e.$Api.EbayMessageSend,Login:!0},Data:e.SendMailForm,Callback:function(a){t(!0),a.IsSuccess||e.SendErrorCodes.push(e.SendMailForm.ShipOrderCode)}})}))}},{key:"CancelModal",value:function(){var e=this;this.$set(this,"StationMailModal",!1),this.$refs.TplCascader.clearSelect(),this.$set(this,"SendMailForm",new m["a"].SendMail),this.$set(this,"SendType",1),this.$set(this,"OrderCodes",[]),this.$set(this,"SendErrorCodes",[]),this.$nextTick((function(){e.$refs.SendMailForm.resetFields()}))}}]),a}(h["d"]);p["a"]([Object(h["c"])({default:!0,type:Boolean})],g.prototype,"IsBtn",void 0),p["a"]([Object(h["b"])()],g.prototype,"EmitOperateSuccess",null),p["a"]([Object(h["b"])()],g.prototype,"TriggerOperations",null),g=p["a"]([Object(h["a"])({name:"WriteStationMail"})],g);var S=g,f=S,v=a("4023"),y=Object(v["a"])(f,n,i,!1,null,"12a4eccf",null);t["default"]=y.exports}}]);