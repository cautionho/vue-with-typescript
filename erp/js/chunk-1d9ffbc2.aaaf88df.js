(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d9ffbc2"],{3116:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Modal",{staticClass:"Container-Tabs",attrs:{title:e.ModalTitle,width:1e3},on:{"on-cancel":e.CancelModal},model:{value:e.ModifyModal,callback:function(t){e.ModifyModal=t},expression:"ModifyModal"}},[r("Form",{ref:"AfterSalesInfo",attrs:{inline:"",model:e.AfterSalesInfo,rules:e.AfterSalesRules,"label-width":90,onsubmit:"return false;"}},[r("Tabs",{attrs:{type:"card",value:e.AfterSalesTabs,name:"AfterSalesTab"},on:{"on-click":e.ChangeTabs}},[r("TabPane",{attrs:{label:"基本信息",name:"Base",tab:"AfterSalesTab"}},[r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"发货单号：",prop:"ShipOrderCode"}},["添加售后单"===e.ModalTitle?r("Input",{ref:"ShipOrderCodeIpt",attrs:{placeholder:"扫描发货单号"},on:{"on-enter":e.ValidateShipOrder},model:{value:e.AfterSalesInfo.ShipOrderCode,callback:function(t){e.$set(e.AfterSalesInfo,"ShipOrderCode",t)},expression:"AfterSalesInfo.ShipOrderCode"}},[r("Button",{attrs:{slot:"append"},on:{click:e.ValidateShipOrder},slot:"append"},[e._v("匹配订单")])],1):r("span",[e._v(e._s(e.AfterSalesInfo.ShipOrderCode))])],1),r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"订单金额："}},[e._v(" "+e._s(e.AfterSalesInfo.PayAmount)+" "+e._s(e.AfterSalesInfo.Currency)+" "+e._s(e.AfterSalesInfo.RefundedAmount?"(已退款"+e.AfterSalesInfo.RefundedAmount+" "+e.AfterSalesInfo.Currency+")":"")+" ")]),r("FormItem",{staticClass:"P-W-49-Percent",attrs:{label:"客服主管：",prop:"SupervisorId"}},[r("Select",{attrs:{placeholder:"客服主管",options:e.SupervisorDrops,transfer:""},model:{value:e.AfterSalesInfo.SupervisorId,callback:function(t){e.$set(e.AfterSalesInfo,"SupervisorId",t)},expression:"AfterSalesInfo.SupervisorId"}})],1),r("FormItem",{staticClass:"P-W-49-Percent",attrs:{label:"原因：",prop:"ReasonType"}},[r("Select",{attrs:{placeholder:"售后原因",options:e.ReasonDrops,transfer:""},model:{value:e.AfterSalesInfo.ReasonType,callback:function(t){e.$set(e.AfterSalesInfo,"ReasonType",t)},expression:"AfterSalesInfo.ReasonType"}})],1),r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"处理方式：",prop:"ProcessType"}},[r("RadioGroup",{model:{value:e.AfterSalesInfo.ProcessType,callback:function(t){e.$set(e.AfterSalesInfo,"ProcessType",t)},expression:"AfterSalesInfo.ProcessType"}},e._l(e.ProcessType,(function(t,a){return r("Radio",{key:a,staticClass:"P-MR-20",attrs:{label:t.Value}},[e._v(e._s(t.Key))])})),1)],1),1===e.AfterSalesInfo.ProcessType||2===e.AfterSalesInfo.ProcessType?r("Col",{attrs:{span:"24"}},[r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"收件人：",prop:"BuyerFullName",rules:{required:!0,message:"请输入收件人"}}},[r("Input",{attrs:{placeholder:"收件人"},model:{value:e.AfterSalesInfo.BuyerFullName,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerFullName",t)},expression:"AfterSalesInfo.BuyerFullName"}})],1),r("FormItem",{staticClass:"P-W-49-Percent",attrs:{label:"省/州：",prop:"BuyerState",rules:{required:!0,message:"请输入省/州"}}},[r("Input",{attrs:{placeholder:"省/州"},model:{value:e.AfterSalesInfo.BuyerState,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerState",t)},expression:"AfterSalesInfo.BuyerState"}})],1),r("FormItem",{staticClass:"P-W-49-Percent",attrs:{label:"城市：",prop:"BuyerCity",rules:{required:!0,message:"请输入城市"}}},[r("Input",{attrs:{placeholder:"城市"},model:{value:e.AfterSalesInfo.BuyerCity,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerCity",t)},expression:"AfterSalesInfo.BuyerCity"}})],1),r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"地址1：",prop:"BuyerStreet1",rules:{required:!0,message:"请输入地址1"}}},[r("Input",{attrs:{placeholder:"地址1"},model:{value:e.AfterSalesInfo.BuyerStreet1,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerStreet1",t)},expression:"AfterSalesInfo.BuyerStreet1"}})],1),r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"地址2：",prop:"BuyerStreet2"}},[r("Input",{attrs:{placeholder:"地址2"},model:{value:e.AfterSalesInfo.BuyerStreet2,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerStreet2",t)},expression:"AfterSalesInfo.BuyerStreet2"}})],1),r("FormItem",{staticClass:"P-W-49-Percent",attrs:{label:"邮编：",prop:"BuyerZipCode",rules:{required:!0,message:"请输入邮编"}}},[r("Input",{attrs:{placeholder:"邮编"},model:{value:e.AfterSalesInfo.BuyerZipCode,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerZipCode",t)},expression:"AfterSalesInfo.BuyerZipCode"}})],1),r("FormItem",{staticClass:"P-W-49-Percent",attrs:{label:"电话：",prop:"BuyerPhone",rules:{required:!0,message:"请输入电话"}}},[r("Input",{attrs:{placeholder:"电话"},model:{value:e.AfterSalesInfo.BuyerPhone,callback:function(t){e.$set(e.AfterSalesInfo,"BuyerPhone",t)},expression:"AfterSalesInfo.BuyerPhone"}})],1),2===e.AfterSalesInfo.ProcessType?r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"金额：",prop:"DiffAmount",rules:{required:!0,message:"请输入差价金额",pattern:e.$Pattern.PositiveNotZero}}},[r("InputNumber",{staticClass:"P-W-400 P-MR-5",attrs:{placeholder:"补差价金额",max:e.AfterSalesInfo.PayAmount,min:0},model:{value:e.AfterSalesInfo.DiffAmount,callback:function(t){e.$set(e.AfterSalesInfo,"DiffAmount",t)},expression:"AfterSalesInfo.DiffAmount"}}),e._v(" "+e._s(e.AfterSalesInfo.Currency)+" ")],1):e._e()],1):e._e(),3===e.AfterSalesInfo.ProcessType||4===e.AfterSalesInfo.ProcessType?r("Col",{attrs:{span:"24"}},[0!==e.Platform?r("Table",{staticClass:"P-MB-20",attrs:{size:"small",stripe:"","span-method":e.HandleSpan,columns:e.GetRefundCols(),data:e.TransitionDetails}}):r("FormItem",{attrs:{label:"金额："}},[4===e.AfterSalesInfo.ProcessType?r("InputNumber",{staticClass:"P-W-400 P-MR-5",attrs:{min:0,max:e.AfterSalesInfo.PayAmount-e.AfterSalesInfo.RefundedAmount},model:{value:e.AfterSalesInfo.FullRefundAmt,callback:function(t){e.$set(e.AfterSalesInfo,"FullRefundAmt",t)},expression:"AfterSalesInfo.FullRefundAmt"}}):e._e(),4===e.AfterSalesInfo.ProcessType?r("span",[e._v(e._s(e.AfterSalesInfo.Currency))]):r("span",[e._v(e._s((e.AfterSalesInfo.PayAmount-e.AfterSalesInfo.RefundedAmount).toFixed(3))+" "+e._s(e.AfterSalesInfo.Currency))])],1)],1):e._e(),r("FormItem",{staticClass:"P-W-100-Percent",attrs:{label:"备注：",prop:"Remark"}},[r("Input",{attrs:{placeholder:"备注"},model:{value:e.AfterSalesInfo.Remark,callback:function(t){e.$set(e.AfterSalesInfo,"Remark",t)},expression:"AfterSalesInfo.Remark"}})],1),r("FormItem",{staticClass:"P-W-100-Percent"},[r("Col",{attrs:{span:"24"}},[e._l(e.AfterSalesInfo.ImageUrl,(function(t,a){return r("div",{key:a,staticClass:"P-Inline-Block P-Uploader-Img"},[r("img",{staticClass:"P-Uploader-Img",attrs:{src:e.$Server.File+"/"+t},on:{click:function(r){return e.$refs.BigPic.Trigger(e.$Server.File+"/"+t)}}}),r("Icon",{staticClass:"P-Uploader-Del",attrs:{type:"md-close-circle",size:"20"},on:{click:function(t){return e.UploaderDel(a)}}})],1)})),r("Upload",{staticClass:"P-Uploader P-Inline-Block P-VA-T",attrs:{headers:e.$Request.Headers({Server:"",Api:{Address:"",Login:!0},Data:"",Form:!0}),"show-upload-list":!1,"on-success":e.HandleUploadSuccess,accept:".jpg, .jpge, .png",format:["jpg","jpeg","png"],"max-size":2048,"on-format-error":e.HandleFormatError,"on-exceeded-size":e.HandleMaxSize,"before-upload":e.HandleBeforeUpload,multiple:"",action:""+e.$Server.Settings+e.$Api.UploadImage}},[r("div",{staticClass:"P-Uploader-Img"},[r("Icon",{attrs:{type:"md-add",size:"20"}})],1)])],2)],1)],1),r("TabPane",{attrs:{label:"问题货品",name:"Issue",tab:"AfterSalesTab"}},[r("Table",{attrs:{size:"small",columns:e.IssueCols,data:e.IssueItems,stripe:"",height:490}})],1),e.AfterSalesInfo.ProcessType<3?r("TabPane",{attrs:{label:"重发货品",name:"Resend",tab:"AfterSalesTab"}},[r("Table",{attrs:{size:"small",columns:e.ResendCols,data:e.ResendItems,stripe:"",height:460}}),r("Col",{staticClass:"P-TA-R P-MT-5",attrs:{span:"24"}},[r("Button",{attrs:{type:"primary"},on:{click:e.EmitEnableSku}},[e._v("选择SKU")])],1)],1):e._e()],1)],1),r("footer",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:function(t){return e.Validate(!0)}}},[e._v("提交审核")]),r("Button",{attrs:{type:"primary"},on:{click:function(t){return e.Validate(!1)}}},[e._v("提交")]),r("Button",{on:{click:e.CancelModal}},[e._v("取消")])],1),r("BigPic",{ref:"BigPic"})],1)},n=[],s=(r("d9b9"),r("6412"),r("02cc"),r("9660"),r("76bb"),r("4d62"),r("6ed5"),r("cee1"),r("1ff3"),r("6bf8"),r("b916"),r("d088"),r("0b78"),r("e24e")),o=(r("b449"),r("5d83")),i=r("3231"),l=r("064d"),u=r("46d7"),f=r("631e"),c=r("4a81"),d=r("d11d"),p=r("4606"),S=function(e){Object(u["a"])(r,e);var t=Object(f["a"])(r);function r(){var e;return Object(i["a"])(this,r),e=t.apply(this,arguments),e.IsModify=!1,e.ModifyModal=!1,e.ModalTitle="添加售后单",e.SupervisorDrops=[],e.ReasonDrops=[],e.AfterSalesTabs="Base",e.Platform=0,e.ProcessType=e.$Utils.GetEnumArr(e.$Enums.CustomerService.ProcessType),e.OriginShipOrderInfo={},e.AfterSalesInfo=new p["a"].AfterSalesInfo,e.AfterSalesRules={ShipOrderCode:[{required:!0,message:"请扫描发货单号/输入发货单号按回车键"}],SupervisorId:[{required:!0,message:"请选择客服主管",trigger:"change",type:"number"},{pattern:e.$Pattern.PositiveNotZeroInt,message:"请选择客服主管"}],ReasonType:[{required:!0,message:"请选择售后原因",trigger:"change",type:"number"},{pattern:e.$Pattern.PositiveNotZeroInt,message:"请选择售后原因"}],ProcessType:[{required:!0,message:"请选择处理方式",trigger:"change",type:"number"}]},e.TransitionDetails=[],e.IssueItems=[],e.ResendItems=[],e.UploadQty=0,e.Cols1=[{title:"交易号",key:"PaypalTransactionId",width:120},{title:"SKU编号",key:"SkuCode",width:130},{title:"SKU名称",key:"SkuName",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"ItemId",key:"ItemId",width:120},{title:"数量",key:"Quantity",width:100},{title:"交易金额",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount," ").concat(t.row.Currency).concat(t.row.RetiredAmount>0?"(已退款"+t.row.RetiredAmount+t.row.Currency+")":""))}},{title:"退款金额",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount-t.row.RetiredAmount," ").concat(t.row.Currency))}}],e.Cols5=[{title:"LineNumber",key:"PaypalTransactionId",width:120},{title:"SKU编号",key:"SkuCode",width:130},{title:"SKU名称",key:"SkuName",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"数量",width:100,key:"Quantity"},{title:"交易金额",key:"PayAmount",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount," ").concat(t.row.Currency).concat(t.row.RetiredAmount>0?"(已退款"+t.row.RetiredAmount+t.row.Currency+")":""))}},{title:"退款金额",key:"PayAmount",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount-t.row.RetiredAmount," ").concat(t.row.Currency))}}],e.Cols17=[{title:"LineItems ID",key:"PaypalTransactionId",width:120},{title:"SKU编号",key:"SkuCode",width:130},{title:"SKU名称",key:"SkuName",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"数量",width:100,key:"Quantity"},{title:"交易金额",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount," ").concat(t.row.Currency).concat(t.row.RetiredAmount>0?"(已退款"+t.row.RetiredAmount+t.row.Currency+")":""))}},{title:"退款金额",width:160,render:function(e,t){return e("span","".concat(t.row.PayAmount-t.row.RetiredAmount," ").concat(t.row.Currency))}}],e.RefundCols1=[{title:"交易号",key:"PaypalTransactionId",width:120},{title:"SKU编号",key:"SkuCode",width:130},{title:"SKU名称",key:"SkuName",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"ItemId",key:"ItemId",width:120},{title:"数量",key:"Quantity",width:100},{title:"交易金额",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount," ").concat(t.row.Currency).concat(t.row.RetiredAmount>0?"(已退款"+t.row.RetiredAmount+t.row.Currency+")":""))}},{title:"退款金额",width:160,render:function(t,r){return t("div",[t("InputNumber",{attrs:{value:r.row.ReAmount,min:0,max:r.row.PayAmount-r.row.RetiredAmount<0?0:r.row.PayAmount-r.row.RetiredAmount},on:{"on-change":function(t){e.ChangeTbVal("TransitionDetails",r.row._index,"ReAmount",t)}},class:"P-MR-5"}),t("span",r.row.Currency)])}}],e.RefundCols5=[{title:"LineNumber",key:"PaypalTransactionId",width:120},{title:"SKU编号",key:"SkuCode",width:130},{title:"SKU名称",key:"SkuName",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"数量",width:100,key:"Quantity"},{title:"交易金额",key:"PayAmount",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount," ").concat(t.row.Currency).concat(t.row.RetiredAmount>0?"(已退款"+t.row.RetiredAmount+t.row.Currency+")":""))}},{title:"退款金额",key:"PayAmount",width:160,render:function(t,r){return t("div",[t("InputNumber",{attrs:{value:r.row.ReAmount,min:0,max:r.row.PayAmount-r.row.RetiredAmount<0?0:r.row.PayAmount-r.row.RetiredAmount},on:{"on-change":function(t){e.ChangeTbVal("TransitionDetails",r.row._index,"ReAmount",t)}},class:"P-MR-5"}),t("span",r.row.Currency)])}}],e.RefundCols17=[{title:"LineItems ID",key:"PaypalTransactionId",width:120},{title:"SKU编号",key:"SkuCode",width:130},{title:"SKU名称",key:"SkuName",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"数量",width:100,key:"Quantity"},{title:"交易金额",key:"PayAmount",width:120,render:function(e,t){return e("span","".concat(t.row.PayAmount," ").concat(t.row.Currency).concat(t.row.RetiredAmount>0?"(已退款"+t.row.RetiredAmount+t.row.Currency+")":""))}},{title:"退款金额",key:"PayAmount",width:160,render:function(t,r){return t("div",[t("InputNumber",{attrs:{value:r.row.ReAmount,min:0,max:r.row.PayAmount-r.row.RetiredAmount<0?0:r.row.PayAmount-r.row.RetiredAmount},on:{"on-change":function(t){e.ChangeTbVal("TransitionDetails",r.row._index,"ReAmount",t)}},class:"P-MR-5"}),t("span",r.row.Currency)])}}],e.IssueCols=[{title:"图片",width:80,align:"center",render:function(t,r){return t("div",{class:"P-List-Img",on:{click:function(){e.$refs.BigPic.Trigger("".concat(e.$Server.File,"/").concat(r.row.ImageUrl||r.row.DefaultImage))}},style:{backgroundImage:"url(".concat(e.$Server.File,"/").concat(r.row.ImageUrl||r.row.DefaultImage,")")}})}},{title:"SKU编号",width:130,key:"SkuCode"},{title:"SKU名称",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"购买数量",width:100,render:function(e,t){return e("span",t.row.Quantity||t.row.BuyCount)}},{title:"原因",width:200,render:function(t,r){return t("Select",{attrs:{placeholder:"请选择原因",value:r.row.ReasonType},props:{filterable:!0,options:e.ReasonDrops,onChange:function(t){e.ChangeTbVal("IssueItems",r.row._index,"ReasonType",t)}}})}},{title:"重发/问题数量",width:160,render:function(t,r){return t("InputNumber",{attrs:{value:r.row.IssueCount,min:0,max:r.row.Quantity?r.row.Quantity:r.row.BuyCount},on:{"on-change":function(t){e.ChangeTbVal("IssueItems",r.row._index,"IssueCount",t)}},class:"P-W-100-Percent"})}}],e.ResendCols=[{title:"图片",width:80,align:"center",render:function(t,r){return console.log(e.$Server.File),t("div",{class:"P-List-Img",on:{click:function(){e.$refs.BigPic.Trigger("".concat(e.$Server.File,"/").concat(r.row.ImageUrl||r.row.DefaultImage))}},style:{backgroundImage:"url(".concat(e.$Server.File,"/").concat(r.row.ImageUrl||r.row.DefaultImage)}})}},{title:"SKU编号",width:130,key:"SkuCode"},{title:"SKU名称",render:function(e,t){return e("Tooltip",{props:{content:t.row.SkuName},class:"P-LINE-1"},t.row.SkuName)}},{title:"重发数量",width:160,render:function(t,r){return t("InputNumber",{attrs:{value:r.row.ReSendCount,min:0},on:{"on-change":function(t){e.ChangeTbVal("ResendItems",r.row._index,"ReSendCount",t)}},class:"P-W-100-Percent"})}},{title:"操作",width:80,render:function(t,r){return t("Button",{props:{size:"small",type:"error"},on:{click:function(){e.DelResendItem(r.row._index)}}},"删除")}}],e}return Object(l["a"])(r,[{key:"EmitEnableSku",value:function(){}},{key:"EmitOperateSuccess",value:function(){}},{key:"WatchSupervisorDrop",value:function(e){this.$set(this,"SupervisorDrops",e)}},{key:"WatchReasonDrop",value:function(e){this.$set(this,"ReasonDrops",e)}},{key:"Focus",value:function(e){this.$refs[e].focus()}},{key:"ChangeTabs",value:function(e){this.$set(this,"AfterSalesTabs",e)}},{key:"ChangeTbVal",value:function(e,t,r,a){this[e][t][r]=a}},{key:"TriggerCreate",value:function(e){this.$set(this.AfterSalesInfo,"ShipOrderCode",e),this.$set(this,"ModifyModal",!0),this.ValidateShipOrder(),this.GetDropLists()}},{key:"GetDropLists",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=this,e.t1=this,e.next=4,this.GetDropList(this.$Server.CustomerService,this.$Api.SaleReasonDropList,1,"Data");case 4:return e.t2=e.sent,e.t0.$set.call(e.t0,e.t1,"ReasonDrops",e.t2),e.t3=this,e.t4=this,e.next=10,this.GetDropList(this.$Server.Admin,this.$Api.GetUserDropList,"客服主管");case 10:e.t5=e.sent,e.t3.$set.call(e.t3,e.t4,"SupervisorDrops",e.t5);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"GetDropList",value:function(e,t,r){var a=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"DropList";return new Promise((function(s){a.$Request.Post({Server:e,Api:{Address:t},Data:r,Callback:function(e){e.IsSuccess?s(e.Data[n]):(s([]),a.$Request.Error(e))}})}))}},{key:"SetReasonDrops",value:function(e){return this.ReasonDrops.map((function(t){return e("Option",{attrs:{value:t.Id}},t.Reason)}))}},{key:"Trigger",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p["a"].AfterSalesList;this.$set(this,"ModifyModal",!0),t.AfterSalerId?(this.$set(this,"IsModify",!0),this.$set(this,"ModalTitle","编辑售后单"),this.GetAfterSalesOrderDetails(t.AfterSalerId)):(this.$set(this,"IsModify",!1),this.$set(this,"ModalTitle","添加售后单"),this.$nextTick((function(){e.Focus("ShipOrderCodeIpt")})))}},{key:"GetAfterSalesOrderDetails",value:function(e){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.AfterSaleDetail,Login:!0},Data:e,Callback:function(e){if(t.$UI.Loading.Hide(),e.IsSuccess){var r=e.Data.Data.OrderInfo.ProcessType<3;t.$set(t,"AfterSalesInfo",{AfterSalerId:e.Data.Data.OrderInfo.AfterSalerId,ShipOrderCode:e.Data.Data.OrderInfo.OriginalShipOrderCode,PayAmount:e.Data.Data.OrderInfo.OriginalPayment,Currency:e.Data.Data.OrderInfo.Currency,RefundedAmount:e.Data.Data.OrderInfo.HistoryRefundAmount,SupervisorId:t.SupervisorDrops.filter((function(t){return t.Key.split("(")[0]===e.Data.Data.OrderInfo.SupervisorName}))[0].Value,ReasonType:t.ReasonDrops.filter((function(t){return t.Reason===e.Data.Data.OrderInfo.Reason}))[0].Id,ProcessType:e.Data.Data.OrderInfo.ProcessType,Remark:e.Data.Data.OrderInfo.Remark,TransactionDetails:e.Data.Data.TransactionDetails,DiffAmount:e.Data.Data.OrderInfo.RefundOrDiffAmount,FullRefundAmt:e.Data.Data.OrderInfo.RefundOrDiffAmount,ImageUrl:e.Data.Data.Images.map((function(e){return e.ImageUrl})),BuyerFullName:r?e.Data.Data.ReSendDetails[0].Address.BuyerFullName:"",BuyerState:r?e.Data.Data.ReSendDetails[0].Address.BuyerState:"",BuyerCity:r?e.Data.Data.ReSendDetails[0].Address.BuyerCity:"",BuyerStreet1:r?e.Data.Data.ReSendDetails[0].Address.BuyerStreet1:"",BuyerStreet2:r?e.Data.Data.ReSendDetails[0].Address.BuyerStreet2:"",BuyerZipCode:r?e.Data.Data.ReSendDetails[0].Address.BuyerZipCode:"",BuyerPhone:r?e.Data.Data.ReSendDetails[0].Address.BuyerPhone:""});var a,n=Object(s["a"])(e.Data.Data.IssueDetails);try{var o=function(){var e=a.value;e["ReasonType"]=t.ReasonDrops.filter((function(t){return t.Reason===e.Reason}))[0].Id};for(n.s();!(a=n.n()).done;)o()}catch(i){n.e(i)}finally{n.f()}t.$set(t,"IssueItems",e.Data.Data.IssueDetails),t.AfterSalesInfo.ProcessType<3&&t.$set(t,"ResendItems",e.Data.Data.ReSendDetails),t.GetShipOrderInfo()}else t.$Request.Error(e)}})}},{key:"ValidateShipOrder",value:function(){var e=this;this.$refs.AfterSalesInfo.validateField("ShipOrderCode",(function(t){t?e.Focus("ShipOrderCodeIpt"):e.GetShipOrderInfo()}))}},{key:"GetShipOrderInfo",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.AfterSaleOriginalShipOrder,Login:!0},Data:this.AfterSalesInfo.ShipOrderCode,Callback:function(t){if(e.$UI.Loading.Hide(),t.IsSuccess){if(!t.Data.Data.ShipOrderCode)return e.$UI.Tips.Floating("warning","匹配订单不存在"),void e.ResetInfo();for(var r in e.$set(e,"OriginShipOrderInfo",t.Data.Data),e.AfterSalesInfo)(e.OriginShipOrderInfo[r]&&!e.AfterSalesInfo[r]||e.OriginShipOrderInfo[r]&&!e.AfterSalesInfo[r].length)&&(e.AfterSalesInfo[r]=e.OriginShipOrderInfo[r]);var a=e.AfterSalesInfo.ShipOrderCode.slice(0,1);e.$set(e,"Platform","E"===a?1:"L"===a?5:"R"===a?17:0),e.$set(e,"TransitionDetails",e.GetTransitionDatas()),e.IsModify||(e.$set(e.AfterSalesInfo,"ProcessType",1),e.$set(e.AfterSalesInfo,"SupervisorId",1===e.Platform?322:325),e.GetHistoryRefund())}else e.$Request.Error(t)}})}},{key:"GetHistoryRefund",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.$Api.AfterSaleHistoryRefund,Login:!0},Data:this.AfterSalesInfo.ShipOrderCode,Callback:function(t){e.$UI.Loading.Hide(),t.IsSuccess?e.$set(e.AfterSalesInfo,"RefundedAmount",t.Data.Data.TotalRefundAmount):e.$Request.Error(t)}})}},{key:"GetRefundCols",value:function(){return 0===this.Platform?[]:3===this.AfterSalesInfo.ProcessType?this["Cols".concat(this.Platform)]:this["RefundCols".concat(this.Platform)]}},{key:"GetTransitionDatas",value:function(){var e=this,t=[];return this.AfterSalesInfo.TransactionDetails.forEach((function(r,a){r["Num"]=a++;var n,o=JSON.parse(JSON.stringify(r)),i=Object(s["a"])(r.SkuInfo);try{for(i.s();!(n=i.n()).done;){var l=n.value;delete o.SkuInfo;var u=Object.assign(l,o,{Span:r.SkuInfo.length,Num:a++});if(t.push(u),!e.IsModify){e.IssueItems=[],e.ResendItems=[];var f=new p["a"].IssueItems;for(var c in f)u[c]&&(f[c]=u[c]);e.IssueItems.push(f);var d=new p["a"].ResendItems;for(var S in d)u[S]&&(d[S]=u[S]);e.ResendItems.push(d)}}}catch(m){i.e(m)}finally{i.f()}})),t}},{key:"HandleSpan",value:function(e){var t=e.row,r=(e.column,e.rowIndex),a=e.columnIndex;return 0===a?0===r||t.Num!==this.TransitionDetails[r-1].Num?{rowspan:t.Span,colspan:1}:{rowspan:0,colspan:0}:{rowspan:1,colspan:1}}},{key:"HandleUploadSuccess",value:function(e,t,r){console.log(e),e.IsSuccess?this.AfterSalesInfo.ImageUrl.push(e.Data.Url):this.$Request.Error(e),this.CountUploadQty()}},{key:"HandleFormatError",value:function(e){this.$UI.Tips.Floating("warning","文件[".concat(e.name,"]格式不为JPG/JPGE/PNG，请检查")),this.CountUploadQty()}},{key:"HandleMaxSize",value:function(e,t){this.$UI.Tips.Floating("warning","文件".concat(e.name,"大小超过2M，请检查")),this.CountUploadQty()}},{key:"HandleBeforeUpload",value:function(e){0===this.UploadQty&&this.$UI.Loading.Show(),this.UploadQty++}},{key:"CountUploadQty",value:function(){this.UploadQty--,this.UploadQty<=0&&this.$UI.Loading.Hide()}},{key:"UploaderDel",value:function(e){this.AfterSalesInfo.ImageUrl.splice(e,1)}},{key:"GetSelectedSku",value:function(e){var t,r=Object(s["a"])(e);try{for(r.s();!(t=r.n()).done;){var a,n=t.value,o=!0,i=Object(s["a"])(this.ResendItems);try{for(i.s();!(a=i.n()).done;){var l=a.value;n.Id===l.SkuId&&(o=!1)}}catch(u){i.e(u)}finally{i.f()}o&&this.ResendItems.push({SkuId:n.Id,SkuCode:n.SkuCode,SkuName:n.SkuName,ReSendCount:0,DefaultImage:n.DefaultImage})}}catch(u){r.e(u)}finally{r.f()}}},{key:"DelResendItem",value:function(e){this.ResendItems.splice(e,1)}},{key:"Validate",value:function(e){var t=this;this.$refs.AfterSalesInfo.validate((function(r){if(r){if(t.AfterSalesInfo.ProcessType<3){if(!t.ResendItems.length)return void t.$UI.Tips.Floating("warning","请选择重发货品");if(!t.IssueItems.some((function(e){return e.IssueCount>0&&e.ReasonType>0})))return void t.$UI.Tips.Floating("warning","请补充问题货品的售后原因和问题数量");if(t.ResendItems.every((function(e){return e.ReSendCount<=0})))return void t.$UI.Tips.Floating("warning","请补充重发货品的重发数量")}if(4===t.AfterSalesInfo.ProcessType)if(0!==t.Platform){if(t.TransitionDetails.every((function(e){return 0===e.ReAmount})))return void t.$UI.Tips.Floating("warning","请补充货品的退款金额");if(t.TransitionDetails.some((function(e){return e.ReAmount>e.PayAmount-e.RetiredAmount})))return void t.$UI.Tips.Floating("warning","请输入正确的退款金额（退款金额不可大于支付金额-已退金额）")}else(t.AfterSalesInfo.FullRefundAmt<=0||t.AfterSalesInfo.FullRefundAmt>t.AfterSalesInfo.PayAmount-t.AfterSalesInfo.RefundedAmount)&&t.$UI.Tips.Floating("warning","请输入正确的退款金额");t.HandlePostDatas(e)}else t.$UI.Tips.Floating("warning","请补充必填项")}))}},{key:"HandlePostDatas",value:function(e){var t={AfterSalerId:this.AfterSalesInfo.AfterSalerId,OriginalShipOrderCode:this.AfterSalesInfo.ShipOrderCode,ProcessType:this.AfterSalesInfo.ProcessType,ReasonType:this.AfterSalesInfo.ReasonType,SupervisorId:this.AfterSalesInfo.SupervisorId,Remark:this.AfterSalesInfo.Remark,ImageUrl:this.AfterSalesInfo.ImageUrl,IsSubmitAudit:e,IssueItems:this.IssueItems.map((function(e){return{SkuId:e.SkuId,SkuCode:e.SkuCode,ReasonType:e.ReasonType,IssueCount:e.IssueCount,DetailId:e.DetailId}}))},r=new p["a"].CreateAfterSalesOrder;if(this.AfterSalesInfo.ProcessType<3){var a=new p["a"].AfterSalesAddress(this.AfterSalesInfo),n=this.ResendItems.map((function(e){return{SkuId:e.SkuId,SkuCode:e.SkuCode,ReSendCount:e.ReSendCount}})),s=Object.assign(t,{ReSendItems:n});r=1===this.AfterSalesInfo.ProcessType?new p["a"].CreateAfterSalesOrder(Object.assign(s,{ReSendAddress:a})):new p["a"].CreateAfterSalesOrder(Object.assign(s,{DiffAndSendAddress:a,DiffAmount:this.AfterSalesInfo.DiffAmount}))}else if(0===this.Platform){var o=3===this.AfterSalesInfo.ProcessType?this.AfterSalesInfo.PayAmount-this.AfterSalesInfo.RefundedAmount:this.AfterSalesInfo.FullRefundAmt;r=new p["a"].CreateAfterSalesOrder(Object.assign(t,{FullRefundAmt:o}))}else r=new p["a"].CreateAfterSalesOrder(Object.assign(t,{TransactionDetails:this.GetPostTransitionDetails()}));this.PostModifyAfterSalesOrder(r)}},{key:"GetPostTransitionDetails",value:function(){var e=this,t=[],r=[];return this.TransitionDetails.forEach((function(a,n){0!==n&&a.Num===e.TransitionDetails[n-1].Num||(r=[]),r.push(new p["a"].AfterSalesSkuInfo(a)),t[a.Num-1]=new p["a"].AfterSalesTransactionDetails(Object.assign(a,{SkuInfo:r}))})),t}},{key:"PostModifyAfterSalesOrder",value:function(e){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.CustomerService,Api:{Address:this.IsModify?this.$Api.AfterSaleEdit:this.$Api.AfterSaleAdd,Login:!0},Data:e,Callback:function(r){r.IsSuccess?(t.$UI.Tips.Floating("success",e.IsSubmitAudit?"提交审核成功":t.IsModify?"修改售后单成功":"添加售后单成功"),t.CancelModal(),t.EmitOperateSuccess()):(t.$UI.Loading.Hide(),t.$Request.Error(r))}})}},{key:"ResetInfo",value:function(){var e=this;this.$set(this,"AfterSalesInfo",new p["a"].AfterSalesInfo),this.$set(this,"TransitionDetails",[]),this.$set(this,"IssueItems",[]),this.$set(this,"ResendItems",[]),this.$set(this,"Platform",0),this.$set(this,"AfterSalesTabs","Base"),this.$nextTick((function(){e.$refs.AfterSalesInfo.resetFields()}))}},{key:"CancelModal",value:function(){this.ResetInfo(),this.$set(this,"ModifyModal",!1)}}]),r}(d["d"]);c["a"]([Object(d["c"])(Array)],S.prototype,"SupervisorDrop",void 0),c["a"]([Object(d["c"])(Array)],S.prototype,"ReasonDrop",void 0),c["a"]([Object(d["b"])()],S.prototype,"EmitEnableSku",null),c["a"]([Object(d["b"])()],S.prototype,"EmitOperateSuccess",null),c["a"]([Object(d["e"])("SupervisorDrop")],S.prototype,"WatchSupervisorDrop",null),c["a"]([Object(d["e"])("ReasonDrop")],S.prototype,"WatchReasonDrop",null),S=c["a"]([Object(d["a"])({name:"ModifyAfterSalesOrder",components:{BigPic:function(){return r.e("chunk-c0a1d894").then(r.bind(null,"6156"))}}})],S);var m=S,I=m,y=(r("e4b0"),r("4023")),h=Object(y["a"])(I,a,n,!1,null,"299efb8c",null);t["default"]=h.exports},6491:function(e,t,r){},e4b0:function(e,t,r){"use strict";var a=r("6491"),n=r.n(a);n.a}}]);