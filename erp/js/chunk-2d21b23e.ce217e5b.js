(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21b23e"],{bf04:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Row",[a("Modal",{attrs:{title:"编辑采购单","mask-closable":!1,width:1200},on:{"on-cancel":function(t){return e.EmitPurchase(!1)}},model:{value:e.EditModal,callback:function(t){e.EditModal=t},expression:"EditModal"}},[a("Form",{ref:"PonBaseData",attrs:{inline:"",model:e.PonBaseData,rules:e.BaseDataRules,"label-width":110,onsubmit:"return false"}},[a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"采购单号：",prop:"PurchaseCode"}},[e._v(" "+e._s(e.PonBaseData.PurchaseCode)+" ")]),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"采购员：",prop:"PurchaserName"}},[e._v(" "+e._s(e.PonBaseData.PurchaserName)+" ")]),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"仓库：",prop:"WarehouseName"}},[a("span",[e._v(e._s(e.PonBaseData.WarehouseName))])]),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"来源：",prop:"SourceType"}},[e._v(" "+e._s(0!==e.PonBaseData.SourceType?e.$Enums.Purchase.SourceType[e.PonBaseData.SourceType]:e.PonBaseData.SourceType)+" ")]),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"采购主管：",prop:"PurchaseManager"}},[a("Select",{staticClass:"P-W-100-Percent",attrs:{placeholder:"请选择采购主管",options:e.PurchaseManagerList},model:{value:e.PonBaseData.PurchaseManager,callback:function(t){e.$set(e.PonBaseData,"PurchaseManager",t)},expression:"PonBaseData.PurchaseManager"}})],1),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"销售主管：",prop:"SaleManagerName"}},[a("span",[e._v(e._s(e.PonBaseData.SaleManagerName))])]),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"供应商：",prop:"SupplyName"}},[a("span",{staticClass:"P-MR-10"},[e._v(e._s(e.PonBaseData.SupplyName))]),a("Button",{attrs:{size:"small",type:"primary"},on:{click:e.OpenSupplierModal}},[e._v("更换供应商")])],1),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"预计到货日期：",prop:"ExpectedTime"}},[a("Date-picker",{staticClass:"P-W-100-Percent",attrs:{type:"date",placeholder:"请选择预计到货日期"},model:{value:e.PonBaseData.ExpectedTime,callback:function(t){e.$set(e.PonBaseData,"ExpectedTime",t)},expression:"PonBaseData.ExpectedTime"}})],1),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"运费：",prop:"ShippingCost"}},[a("InputNumber",{staticStyle:{width:"420px"},attrs:{min:0},on:{"on-change":e.ChangeVal},model:{value:e.PonBaseData.ShippingCost,callback:function(t){e.$set(e.PonBaseData,"ShippingCost",t)},expression:"PonBaseData.ShippingCost"}}),e._v(" CNY ")],1),a("Form-item",{staticClass:"P-W-49-Percent",attrs:{label:"平台单号：",prop:"ThirdOrderCode"}},[a("Input",{attrs:{placeholder:"请输入第三方平台单号"},model:{value:e.PonBaseData.ThirdOrderCode,callback:function(t){e.$set(e.PonBaseData,"ThirdOrderCode",t)},expression:"PonBaseData.ThirdOrderCode"}})],1),a("Form-item",{staticClass:"P-W-100-Percent",attrs:{label:"备注：",prop:"Remark"}},[a("Input",{attrs:{placeholder:"请输入备注"},model:{value:e.PonBaseData.Remark,callback:function(t){e.$set(e.PonBaseData,"Remark",t)},expression:"PonBaseData.Remark"}})],1)],1),a("div",[a("Table",{staticClass:"P-MT-10",attrs:{size:"small","highlight-row":!0,columns:e.ReviewItemCol,data:e.ReviewItemData,border:"",stripe:"",height:"300"}}),a("p",[e._v("统计：产品种类数 "+e._s(e.ReviewItemData.length)+"；产品总数量 "+e._s(e.TotalAmount)+"；采购总价 "+e._s(e.PurchaseTotalAmount+" CNY")+"；总节约成本 "+e._s(e.TotalSaveAmount+" CNY"))])],1),a("footer",{attrs:{slot:"footer"},slot:"footer"},[e.Power?a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.CheckPON(!0)}}},[e._v("提交审核")]):e._e(),a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.CheckPON(!1)}}},[e._v("修改")]),a("Button",{on:{click:function(t){return e.EmitPurchase(!1)}}},[e._v("取消")])],1)],1),a("ShowBigPic",{ref:"ShowBigPic"}),a("EnableSupplier",{ref:"ShowEnableModal",attrs:{AddCityList:e.CityTrees},on:{"emit-eable-supplier":e.CloseEnableSupp}})],1)},i=[],s=(a("9660"),a("4d62"),a("cee1"),a("ef8f"),a("6bf8"),a("0b78"),a("5c62")),n=a("3231"),o=a("064d"),u=a("46d7"),c=a("631e"),l=a("4a81"),h=a("d11d"),p=a("c638"),d=function(e){Object(u["a"])(a,e);var t=Object(c["a"])(a);function a(){var e;return Object(n["a"])(this,a),e=t.apply(this,arguments),e.PonBaseData=new p["a"].PurchaseDetail,e.SelectedData=[],e.ReviewItemData=[],e.PurchaseManagerList=[],e.EditModal=!1,e.IsLoadingEnableTab=!0,e.CityTrees=[],e.TotalAmount=0,e.PurchaseTotalAmount=0,e.TotalSaveAmount=0,e.ReviewItemCol=[{title:"图片",key:"DefaultImage",width:80,align:"center",render:function(t,a){return t("div",{style:{width:"30px",height:"30px",background:"url("+e.$Server.File+"/"+a.row.Item.DefaultImage+") no-repeat",backgroundSize:"cover",margin:"0 auto",cursor:"pointer"},on:{click:function(){e.ShowPic(a.row.Item.DefaultImage)}}})}},{title:"sku编号/产品名称",key:"",width:160,render:function(e,t){return e("div",[e("p",[e("span",{},t.row.Item.SkuCode)]),e("p",[e("span",{},t.row.Item.SkuName)])])}},{title:"在线库存/在途库存",key:"",width:160,render:function(e,t){return e("div",[e("p",[e("span",{class:"P-Table-Tip P-BG-Primary"},"当"),e("span",{},t.row.Inventory.Quantity)]),e("p",[e("span",{class:"P-Table-Tip P-BG-Primary"},"途"),e("span",{},t.row.Inventory.PurchasingQuantity)])])}},{title:"销售数据",key:"",render:function(e,t){return e("span",t.row.AvgSaleQuantity.AvgSaleQuantity30+"/"+t.row.AvgSaleQuantity.AvgSaleQuantity15+"/"+t.row.AvgSaleQuantity.AvgSaleQuantity7)}},{title:"采购数量",key:"",render:function(t,a){return t("div",[t("InputNumber",{style:{width:"100%"},props:{min:0,value:a.row.Item.PurchaseQuantity},on:{"on-change":function(t){e.SetPurchaseQuantity(t,a.index)}}})])}},{title:"单价",key:"",width:140,render:function(t,a){return t("div",[t("InputNumber",{style:{width:"60px",marginRight:"5px"},props:{min:0,value:a.row.Item.PurchasePrice},on:{"on-change":function(t){e.SetPurchasePrice(t,a.index)}}}),t("span",a.row.Item.CurrencyCode)])}},{title:"上次采购价格",key:"",width:110,render:function(e,t){return e("span","￥"+t.row.Item.LastTimePrice)}},{title:"历史最低单价",key:"",width:110,render:function(e,t){return e("span","￥"+t.row.Item.LowestPrice)}},{title:"节约成本",key:"",render:function(e,t){return e("span","￥"+((t.row.Item.LowestPrice-t.row.Item.PurchasePrice)*t.row.Item.PurchaseQuantity).toFixed(3))}},{title:"操作",width:80,render:function(t,a){return t("div",[t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.DelItem(a.index)}}},"删除")])}}],e.BaseDataRules={PurchaseManager:[{required:!0,message:"请选择采购主管",trigger:"change",type:"number"}],ExpectedTime:[{required:!0,message:"请选择预计到货日期",trigger:"change",type:"date"}],ShippingCost:[{required:!0,message:"运费必须大于0",trigger:"change",type:"number"}]},e}return Object(o["a"])(a,[{key:"EmitPurchase",value:function(e){this.EditModal=!1,this.$refs.PonBaseData.resetFields()}},{key:"TriggerModal",value:function(e){this.SelectedData=e,this.GetDropList(),this.CityTrees.length<1&&this.GetAreaTree(),this.EditModal=!0}},{key:"GetDropList",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Admin,Api:{Address:this.$Api.GetUserDropList,Login:!0},Data:"采购主管",Callback:function(t){t.IsSuccess?e.PurchaseManagerList=t.Data.DropList:e.$Request.Error(t),e.GetDetailInfo()}})}},{key:"GetDetailInfo",value:function(){var e=this;this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:this.$Api.PurchaseOrderGetInfo,Login:!0},Data:this.SelectedData[0].Id,Callback:function(t){if(t.IsSuccess){e.PonBaseData=t.Data.Data;var a=e.PonBaseData.ExpectedTime.slice(0,4);e.$set(e.PonBaseData,"ExpectedTime","1901"==a||"0001"==a||"1900"==a?"":new Date(e.PonBaseData.ExpectedTime)),e.$set(e.PonBaseData,"PurchaseManager",0===e.PonBaseData.PurchaseManager?"":e.PonBaseData.PurchaseManager)}else e.$Request.Error(t);e.GetReviewItem()}})}},{key:"GetReviewItem",value:function(){var e=this;this.$set(this,"ReviewItemData",[]),this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:this.$Api.PurchaseOrderGetItem,Login:!0},Data:this.SelectedData[0].Id,Callback:function(t){var a;t.IsSuccess?((a=e.ReviewItemData).push.apply(a,Object(s["a"])(t.Data.Data)),e.StatisticalSum()):e.$Request.Error(t);e.$UI.Loading.Hide()}})}},{key:"GetAreaTree",value:function(){var e=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Settings,Api:{Address:this.$Api.ProvincialAreasGetTree,Login:!1},Data:"",Callback:function(t){t.IsSuccess?(e.$set(e,"CityTrees",t.Data.Tree),e.SetTreeMenu(e.CityTrees)):e.$Request.Error(t),e.$UI.Loading.Hide()}})}},{key:"SetTreeMenu",value:function(e){for(var t in e)this.$set(e[t],"label",e[t].Name),this.$set(e[t],"value",e[t].Id),0!=e[t].ChildNodes.length&&(e[t]["children"]=e[t].ChildNodes,this.SetTreeMenu(e[t].children))}},{key:"OpenSupplierModal",value:function(){this.$refs["ShowEnableModal"].TriggerModal(!1,this.IsLoadingEnableTab,!1)}},{key:"CloseEnableSupp",value:function(e,t,a){this.IsLoadingEnableTab=t,e&&(this.PonBaseData.SupplyName=a[0].SupplyName,this.PonBaseData.SupplyId=a[0].Id)}},{key:"StatisticalSum",value:function(){for(var e in this.TotalAmount=0,this.PurchaseTotalAmount=0,this.TotalSaveAmount=0,this.ReviewItemData)this.TotalAmount=this.TotalAmount+this.ReviewItemData[e].Item.PurchaseQuantity,this.PurchaseTotalAmount=this.PurchaseTotalAmount+this.ReviewItemData[e].Item.PurchasePrice*this.ReviewItemData[e].Item.PurchaseQuantity,this.TotalSaveAmount=this.TotalSaveAmount+(this.ReviewItemData[e].Item.LowestPrice-this.ReviewItemData[e].Item.PurchasePrice)*this.ReviewItemData[e].Item.PurchaseQuantity}},{key:"ShowPic",value:function(e){this.$refs.ShowBigPic.Trigger(e)}},{key:"ChangeVal",value:function(){var e=this;this.$nextTick((function(){e.$set(e.PonBaseData,"ShippingCost",parseFloat((100*e.PonBaseData.ShippingCost/100).toFixed(2)))}))}},{key:"DelItem",value:function(e){1!=this.ReviewItemData.length?this.ReviewItemData.splice(e,1):this.$UI.Tips.Floating("warning","采购单至少需要保留一条明细")}},{key:"SetPurchaseQuantity",value:function(e,t){this.ReviewItemData[t].Item.PurchaseQuantity=e,this.StatisticalSum()}},{key:"SetPurchasePrice",value:function(e,t){this.ReviewItemData[t].Item.PurchasePrice=e,this.StatisticalSum()}},{key:"CheckPON",value:function(e){var t=this;this.$refs["PonBaseData"].validate((function(a){if(a){for(var r in t.ReviewItemData)if(0==t.ReviewItemData[r].Item.PurchasePrice)return void t.$UI.Tips.Floating("warning","[".concat(t.ReviewItemData[r].Item.SkuCode,"]单价必须大于0"));var i=new p["a"].PurchasePostModify;i["Id"]=t.SelectedData[0].Id,i["SaleManager"]=t.PonBaseData.SaleManagerName,i["PurchaseManager"]=t.PonBaseData.PurchaseManager,i["SupplyId"]=t.PonBaseData.SupplyId,i["ExpectedTime"]=t.$UI.Render.NewDate(t.PonBaseData.ExpectedTime),i["ShippingCost"]=t.PonBaseData.ShippingCost,i["ThirdOrderCode"]=t.PonBaseData.ThirdOrderCode,i["Remark"]=t.PonBaseData.Remark,i["IsSbumit"]=e,t.ReviewItemData.forEach((function(e){var t=new p["a"].PurchasePostModifyItem;t["Id"]=e.Item.Id,t["CurrencyCode"]=e.Item.CurrencyCode,t["PurchasePrice"]=e.Item.PurchasePrice,t["PurchaseQuantity"]=e.Item.PurchaseQuantity,i.Item.push(t)})),t.PostReview(i)}}))}},{key:"PostReview",value:function(e){var t=this;this.$UI.Loading.Show(),this.$Request.Post({Server:this.$Server.Purchase,Api:{Address:this.$Api.PurchaseOrderModify,Login:!0},Data:e,Callback:function(a){a.IsSuccess?(t.$UI.Tips.Floating("success",e.IsSbumit?"提交审核成功":"编辑采购单成功"),t.EmitPurchase(!0)):(t.$Request.Error(a),t.$UI.Loading.Hide())}})}}]),a}(h["d"]);l["a"]([Object(h["c"])()],d.prototype,"Power",void 0),l["a"]([Object(h["b"])()],d.prototype,"EmitPurchase",null),d=l["a"]([Object(h["a"])({name:"ModifyPon",components:{EnableSupplier:function(){return a.e("chunk-2d224590").then(a.bind(null,"e06e"))},ShowBigPic:function(){return a.e("chunk-c0a1d894").then(a.bind(null,"6156"))}}})],d);var m=d,P=m,v=a("4023"),D=Object(v["a"])(P,r,i,!1,null,null,null);t["default"]=D.exports}}]);